
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Store</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">  
<script src="https://maps.googleapis.com/maps/api/js?key=TA_CLE_API&libraries=geometry"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: white;
}


/* BANNI√àRE */
.store-banner {
  max-width: 1200px;          /* largeur max pour ne pas coller aux bords */
  height: 245px;              /* hauteur r√©duite un peu plus √©l√©gante */
  background-color: #f0f0f0;  /* gris clair si pas d'image */
  background-size: cover;
  background-position: center;
  margin: 4px auto 0px;     /* espace au-dessus (20px) et au-dessous (30px) */
  border-radius: 15px;        /* arrondis comme Uber */
  box-shadow: 0 2px 6px rgba(0,0,0,0.08); /* petite ombre douce */
position: relative;
}


    /* LAYOUT INFOS + MENU */
 .store-layout {
      display: flex;
      padding: 23px;
      gap: 35px;
    }


    /* BLOC INFOS √Ä GAUCHE */
.store-info {
  flex: 0 0 250px;
  position: sticky;
  top: 100px;
  align-self: flex-start;
  height: calc(100vh - 120px);
  display: flex;
  flex-direction: column;
  margin-left: 100px;
}

.store-details {
  flex: 0 0 auto;
  padding-bottom: 15px;
  border-bottom: 1px solid #ddd;
  margin-bottom: 10px;
}

.categories-scroll {
  flex: 1 1 auto;
  overflow-y: auto;
  padding-right: 5px;
}

.categories-scroll::-webkit-scrollbar {
  width: 6px;
}
.categories-scroll::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 3px;
}
.categories-scroll::-webkit-scrollbar-thumb:hover {
  background: #aaa;
}

    .store-info h1 {
      margin-top: 0;
      font-size: 2rem;
    }
    .store-meta {
      font-size: 0.95rem;
      color: #555;
      margin-bottom: 8px;
    }
    .store-address {
      margin-top: 10px;
      font-size: 0.95rem;
      color: #333;
    }

    /* CONTENU √Ä DROITE (placeholder pour la suite) */
    .store-content {
      flex: 1;
      min-height: 400px;
margin-right: 100px;     
}


.store-categories {
  list-style: none;
  padding: 0;
  margin: 8px 0 0; /* espace augment√© */
  width: 100%;
}

.category-item { 
  padding: 10px 15px;
  margin-bottom: 9px;  /* üëà espace entre chaque cat√©gorie */
  cursor: pointer;
  background: white;
  transition: background 0.3s;
}

.category-item:hover {
  background: #f5f5f5;
}

.category-item.active {
  background: #e0e0e0; /* gris clair */
  color: #000;         /* texte noir */
}


  
.store-content {
  flex: 1;
  padding: 20px;   
  background: #fff;
}


.category-block {
  margin-bottom: 15px;
}

.category-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.category-header h2 {
  font-size: 1.4rem;
  font-weight: bold;
}

.arrows {
  font-size: 1.2rem;
  cursor: pointer;
}



.store-layout {
  display: flex;
  gap: 80px;
}




/* Nettoy√© : plus de fond blanc ni ombre */

.product-card {
  flex: 1;
  min-width: 160px;
  max-width: 180px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  cursor: pointer;
  padding: 0;            /* plus de padding */
  background: none;      /* enl√®ve le bloc blanc */
  border-radius: 0;      /* supprime les coins arrondis du bloc */
  box-shadow: none;      /* enl√®ve l‚Äôombre */
  text-align: left;
}

.products-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4 cartes fixes */
  gap: 10px; /* espace entre cartes */
  align-items: start; /* aligne bien avec les fl√®ches */
}

.product-card img {
  width: 100%;
  aspect-ratio: 1/1;       /* carr√©, comme Uber Eats */
  object-fit: cover;
  border-radius: 16px;     /* arrondi propre */
}
  

.product-card h3 {
  font-size: 17px;     /* + gros */
  font-weight: 500;    /* plus gras */
  margin: 6px 0 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.product-meta {
  display: flex;
  gap: 8px;
  font-size: 15px;     /* + gros */
  color: #333;
}

.product-meta .price {
  font-weight: bold;
}

.product-meta .orders {
  font-size: 15px;     /* l√©g√®rement + gros aussi */
}








/* Bloc global */
.delivery-block {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 12px 16px;
  margin-top: 10px;         /* espace au-dessus */
  margin-left: auto;        /* pousse le bloc √† droite */
  margin-right: 0;          /* colle au bord droit */
  max-width: 350px;
}

/* Ligne frais livraison */
.delivery-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: #333;
  margin-bottom: 10px; /* espace avec la 2√®me ligne */
}

.delivery-info .separator {
  flex: 0;
  margin: 0 8px;
  color: #aaa;
}

.delivery-info span {
  flex: 1;
  text-align: center;
}

.extra-fees {
  display: flex;
  justify-content: space-between; /* deux colonnes : gauche / droite */
  align-items: center;
  font-size: 14px;
  color: #333;
  margin-top: 8px; /* espace avec la ligne du dessus */
}




/* Colonne droite : bouton Modifier */
.extra-fees .btn-modify {
  flex: 1;
  text-align: center;
  background-color: #f0f0f0;
  color: #000;
  border: none;
  border-radius: 6px;
  padding: 6px 12px;
  font-size: 13px;
  cursor: pointer;
  max-width: fit-content;

  /* üëâ Tu ajustes ici */
  margin-top: 0px;     /* d√©cale vers le bas/haut */
  margin-left: 50px;   /* tu peux remplacer auto par une valeur px */
  margin-right: auto;  /* idem ici pour l‚Äôaffiner */
}

.extra-fees .btn-modify:hover {
  background-color: #e0e0e0;
}


/* Bloc texte "Autres frais" + i */
.extra-fees .fees-label {
  display: flex;
  align-items: center;
  gap: 6px;               /* espace entre le texte et le i */
  font-size: 14px;
  color: #333;

  /* üëâ Tu ajustes ici */
  margin-top: -5px;        /* espace vertical */
  margin-left: auto;      /* centr√© par d√©faut */
  margin-right: auto;     /* modifie pour d√©caler */
}

/* Cercle i */
.extra-fees .info-icon {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 1px solid #555;
  font-size: 12px;
  font-weight: bold;
  cursor: pointer;

}





.arrows {
  display: flex;
  gap: 8px;
  align-items: center;
}

.arrow-btn {
  background: #f0f0f0;
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  transition: background 0.2s, transform 0.2s;
}

.arrow-btn:hover {
  background: #ddd;
  transform: scale(1.1);
}







/* --- POPUP GLOBAL --- */
.popup-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.55);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(3px);
}

.popup-content {
  background: #fff;
  border-radius: 16px;
  width: 90%;
  max-width: 900px;
  padding: 24px;
  position: relative;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  animation: popupFade 0.25s ease;
  display: flex;
  gap: 24px; /* espace entre image et contenu */
}

@keyframes popupFade {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

/* --- IMAGE GAUCHE --- */
.popup-left {
  flex: 1;
}

.popup-left img {
  width: 100%;
  height: 100%;
  border-radius: 12px;
  object-fit: cover;
}

/* --- CONTENU DROITE --- */
.popup-right {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  gap: 14px;
}

.popup-right h2 {
  margin: 0;
  font-size: 28px;
  font-weight: bold;
  color: #111;
}

#popup-price {
  font-size: 22px;
  font-weight: 600;
  color: #000;
  margin-top: -4px; /* rapproch√© du titre */
}

/* --- SELECTEUR QUANTIT√â PRO --- */
#popup-quantity {
  margin: 12px 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

#popup-quantity label {
  font-weight: 600;
  font-size: 15px;
  color: #333;
}

/* wrapper pour contr√¥ler l‚Äôapparence */
.select-wrapper {
  position: relative;
  display: inline-block;
  min-width: 100px;
}

#popup-quantity-select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  width: 100%;
  padding: 12px 16px;
  font-size: 16px;
  font-weight: 500;
  border: 1.8px solid #ddd;
  border-radius: 12px;
  background: #f9f9f9;
  color: #111;
  cursor: pointer;

  /* espace pour la fl√®che custom */
  padding-right: 40px;
}

/* Fl√®che custom */
.select-wrapper::after {
  content: "‚ñº";
  font-size: 12px;
  color: gray;
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
}

#popup-quantity-select:hover {
  border-color: #aaa;
  background-color: #fefefe;
}

#popup-quantity-select:focus {
  outline: none;
  border-color: #000;
  box-shadow: 0 0 0 3px rgba(0,0,0,0.08);
}

/* --- FOOTER (Bouton) --- */
.popup-footer {
  margin-top: 8px;
  text-align: center;
}

.popup-footer button {
  background-color: #000;
  color: #fff;
  border: none;
  padding: 16px;
  font-size: 17px;
  font-weight: bold;
  border-radius: 12px;
  cursor: pointer;
  width: 100%;
  transition: background-color 0.2s ease, transform 0.1s ease;
}

.popup-footer button:hover {
  background-color: #333;
}

.popup-footer button:active {
  transform: scale(0.97);
}

/* --- DESCRIPTION --- */
#popup-desc {
  font-size: 15px;
  line-height: 1.5;
  color: #555;
  text-align: left;
}

/* --- CROIX FERMETURE --- */
.popup-content .close {
  position: absolute;
  top: 12px;
  right: 15px;
  width: 32px;
  height: 32px;
  font-size: 22px;
  line-height: 32px;
  text-align: center;
  font-weight: bold;
  color: #333;
  cursor: pointer;
  border-radius: 50%;
  transition: background-color 0.2s ease;
}

.popup-content .close:hover {
  background-color: rgba(0, 0, 0, 0.08);
}

/* --- RESPONSIVE --- */
@media (max-width: 768px) {
  .popup-content {
    flex-direction: column;
    padding: 16px;
  }

  .popup-left img {
    width: 100%;
    max-height: 220px;
    object-fit: cover;
  }

  .popup-right {
    width: 100%;
    text-align: center;
    gap: 12px;
  }

  #popup-desc {
    text-align: center;
  }
}







/* --- HEADER --- */
header {
  position: sticky;
  top: 0;
  z-index: 50;
  background: #fff;   /* üëâ fond blanc pur */
  backdrop-filter: none; /* üëâ enl√®ve le flou */
  height: 64px;
border-bottom: 1px solid #ddd;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05); /* üëâ optionnel : ombre douce */
}
.nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  height: 100%;
  padding: 0 20px;
}

.burger-btn {
  background: none;
  border: none;
  font-size: 30px;
  cursor: pointer;
  color: var(--ink);
height: 100px;
}

header .brand {
  text-decoration: none !important; /* enl√®ve le soulignement */
  border: none !important;
  outline: none !important;
  color: #000 !important;           /* garde FlashBring en noir */
}

.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 800;
  color: #000; /* FlashBring en noir */
}

.brand-badge {
  width: 36px;
  height: 36px;
  border-radius: 10px;      /* angles arrondis */
  display: grid;
  place-items: center;
  background: #000;         /* carr√© fond noir */
  color: #fff;              /* √©clair en blanc */
  font-size: 18px;
}

.actions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.cart-btn {
  position: relative;
  background: transparent; /* plus de fond */
  color: #000; /* ic√¥ne panier en noir */
  width: 32px;
  height: 35px;
  border-radius: 12px;
  display: grid;
  place-items: center;
  font-size: 18px;
  cursor: pointer;
  border: none;
  transition: transform 0.1s ease;
}

.cart-btn:hover {
  transform: scale(1.1);
}

.cart-badge {
  position: absolute;
  top: -6px;
  right: -6px;
  background: #e53935; /* rouge vif */
  color: #fff;
  font-size: 10px;
  font-weight: 600;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sidebar {
  position: fixed;
  top: 0;
  left: -100%;           /* üëà cach√© en dehors de l‚Äô√©cran, c√¥t√© gauche */
  width: 100%;  
  max-width: 300px;      /* largeur fixe comme Uber */
  height: 100vh;         /* prend toute la hauteur */
  background: #fff;
  box-shadow: 2px 0 8px rgba(0,0,0,0.15); /* ombre c√¥t√© droit */
  transition: left 0.3s ease;
  z-index: 200;
  display: flex;  
  flex-direction: column;
}

.sidebar.open {
  left: 0;               /* üëà glisse depuis la gauche */
}

.sidebar-header {
  padding: 16px;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #fff;
}
.sidebar-links {  
  list-style: none;
  padding: 0;
  margin: 0;    
  flex: 1;
  background: #fff;
}
  
  
.sidebar-links a {
  display: block; 
  padding: 14px 18px;
  font-size: 15px;   
  color: #000;
  transition: background 0.2s;
 text-decoration: none !important; /* ‚úÖ enl√®ve le soulignement */
}
  
.sidebar-links a:hover {
  background: #f8f8f8;
}
.close-btn {
  cursor: pointer;
  font-size: 18px;
}
/* Overlay gris transparent sur toute la page */
.sidebar-overlay {
  position: fixed;
  top: 0; 
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.4); /* gris fonc√© transparent */
  z-index: 150;                /* sous le side cart mais au-dessus de tout le reste */
  display: none;               /* cach√© par d√©faut */
} 

.sidebar-overlay.active {
  display: block;
}
  
.sidebar-user {
  text-align: center;
  padding: 20px;
}

#sidebarName {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 4px;
}
.manage-account {
  font-size: 14px;
  color: #007bff; 
  text-decoration: none;
}
.manage-account:hover {
  text-decoration: underline;
}
  
/* Style sp√©cifique pour "G√©rer le compte" */
.sidebar-links a.manage-account {
  color: #007bff;       /* bleu comme Uber par ex */
  font-weight: 600;     /* un peu plus gras */
}
.sidebar-user {
  text-align: center;
  padding: 20px;
} 
#sidebarName {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 6px;
}

.store-info .store-address {
  padding-bottom: 40px;         /* espace sous l‚Äôadresse */
  border-bottom: 1px solid #ddd; /* ligne grise fine */
  margin-bottom: 40px;           /* espace apr√®s la ligne */
}



.left-group {
  display: flex;
  align-items: center;
  gap: 30px;   /* üëâ espace entre le burger et FlashBring, tu ajustes */
}

.brand-text {
  font-size: 18px;
  letter-spacing: -0.3px;
  font-weight: 800;
  color: #000;
}

/* Boutons flottants dans la banni√®re */
.banner-actions {
  position: absolute;
  top: 25px;
  right: 30px;
  display: flex;
  gap: 10px;
}

.banner-actions .action-btn {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: #fff;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: background 0.2s;

}

.banner-actions .action-btn:hover {
  background: #f5f5f5;
}

.banner-actions .action-btn i {
  font-size: 18px;
  color: #000; /* coeur rempli noir */
}


.context-menu {
  position: absolute;
  top: 75px;   /* sous les trois points */
  right: 45px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.15);
  display: none;          /* masqu√© par d√©faut */
  flex-direction: column;
  z-index: 1200;
  min-width: 250px;
}

.context-menu a {
  padding: 15px 20px;
  font-size: 16px;
  color: #000;
  text-decoration: none;
  display: flex;
  align-items: flex-start; /* aligne en haut si plusieurs lignes */
  gap: 10px;
  transition: background 0.2s;
}


.context-menu .info-texts {
  display: flex;
  flex-direction: column;
  line-height: 1.3;
}

.context-menu .info-texts small {
  font-size: 13px;
  color: #777; /* gris clair */
}

.menu-separator {
  height: 1px;
  background: #ddd; /* gris clair */
  margin: 0 10px;
}


/* Overlay popup */
.popup-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.5);
  display: none;
  z-index: 900;
}

/* Conteneur popup */
.info-popup {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 90%;
  max-width: 400px;
  background: #fff;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.25);
  display: none;
  z-index: 1000;
}

/* Bouton de fermeture (croix) */
.info-popup .close-btn {
  background: none;
  border: none;
  font-size: 28px;     /* üëâ plus gros (avant 20px) */
  cursor: pointer;
  color: #000;
  margin-bottom: 10px;

  width: 36px;         /* largeur fixe */
  height: 36px;        /* hauteur fixe */
  border-radius: 50%;  /* rond parfait */
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s ease;
}

.info-popup .close-btn:hover {
  background-color: rgba(0,0,0,0.1); /* üëâ rond gris clair au hover */
}


/* Lignes */
.info-popup hr {
  border: none;
  border-top: 1.5px solid #eee;
  margin: 23px -20px;   /* √©tend √† gauche et √† droite */
  width: calc(100% + 40px); /* compense les 2x20px du padding */
}
/* Rows */
.info-row {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 17px;
  color: #111;
}
.info-row i {
  color: #000;
  min-width: 18px;
}
.info-popup h2 {
  font-size: 35px;  /* üëà taille du titre */
}

.legal-info {
  font-size: 12px;      /* texte plus petit */
  color: #555;          /* gris sobre */
  margin-top: 10px;     /* r√©duit l‚Äôespace au-dessus */
  text-align: left;     
  line-height: 1.3;     /* r√©duit l‚Äôespace entre les lignes */
}

.legal-info p {
  margin: 2px 0;        /* r√©duit au minimum l‚Äôespace entre les paragraphes */
}

.legal-info strong {
  font-size: 12px;      /* m√™me taille que le reste */
  color: #555;          /* m√™me couleur que le reste */
  font-weight: bold;    /* garde juste le gras */
}

.user-address {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
  font-weight: 500;
  color: #111;
}
.user-address i {
  color: red; /* ic√¥ne Google Maps rouge */
}


/* üëâ Sidecart panier */
.cart-sidebar {
  position: fixed;
  top: 0;
  right: -100%; /* cach√© par d√©faut */
  width: 475px;
  max-width: 100%;
  height: 100vh;
  background: #fff;
  box-shadow: -2px 0 8px rgba(0,0,0,0.15);
  transition: right 0.3s ease;
  z-index: 300;
  display: flex;
  flex-direction: column;
}

.cart-sidebar.open {
  right: 0; /* glisse depuis la droite */
}

.cart-header {
  display: flex;
  justify-content: center; /* üëâ centre le texte */
  align-items: center;
  padding: 16px;
  border-bottom: 1px solid #eee;
  position: relative; /* permet de placer la croix sans casser le centrage */
}

.cart-header h2 {
  font-size: 18px;
  margin: 0;
  font-weight: 600;
  text-align: center;
  flex: 1; /* occupe toute la largeur dispo pour bien rester centr√© */
}

.close-cart {
  font-size: 30px;
  cursor: pointer;
  position: absolute;
  left: 16px;
  top: 18px;
  width: 32px;        /* largeur fixe */
  height: 32px;       /* hauteur fixe */
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%; /* vrai cercle */
  transition: background 0.2s;
}

.close-cart:hover {
  background: #f2f2f2; /* rond gris clair au survol */
}

.cart-body {
  flex: 1;
  padding: 16px;
  overflow-y: auto;
}

.cart-dots {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  color: #000;
  width: 32px;
  height: 35px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  transition: background 0.2s;
}

.cart-dots:hover {
  background: #f2f2f2; /* üëà rond gris clair au hover */
}

/* üëâ Bloc infos store dans le panier */
.cart-store-info {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}

#cartStoreImg {
  width: 70px !important;
  height: 70px !important;
  border-radius: 50%;
}

#cartStoreName {
  margin: 0;
  font-size: 20px !important;  /* üëà taille du nom */
  font-weight: 600;
}

#cartStoreAddress {
  margin-top: 8px !important;        /* espace entre nom et adresse */
  font-size: 15px !important;
  color: #666;
}

.cart-accordion .accordion-toggle {
  display: flex;
  align-items: center;
  justify-content: center;   /* centre le label et l'ic√¥ne panier */
  gap: 8px;
  width: 100%;
  padding: 10px;
  background: #f5f5f5;
  border: none;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  position: relative;
}

.cart-accordion .accordion-toggle.active {
  background: #e5e5e5;
}

.cart-accordion .accordion-content {
  display: none;
  padding: 10px 0;
}

/* Label centr√© */
#cartAccordionLabel {
  flex: 1;
  text-align: center;
}

/* Fl√®che coll√©e √† droite */
#cartAccordionArrow {
  position: absolute;
  right: 12px;
}
#cartItems li {
  border-bottom: 1px solid #eee; /* ligne de s√©paration tr√®s fine */
  padding-bottom: 8px;
  margin-bottom: 8px;
}

#cartItems li:last-child {
  border-bottom: none; /* pas de ligne apr√®s le dernier */
}

#cartItems li:first-child {
  margin-top: 15px !important; /* espace uniquement avant le 1er produit */
}





/* Titre "Total de la commande" */
.cart-total {
  font-size: 18px;
  font-weight: bold;
  margin-top: 20px;
}



/* Sous-total */
.cart-subtotal {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
}
.cart-subtotal span:last-child {
  margin-left: auto;
  text-align: right;
}

/* Bloc "Frais" + ic√¥ne i */
.cart-fees {
  display: flex;
  align-items: center;
  gap: 8px;            /* espace entre "Frais" et le i */
  margin-top: 20px;
  font-size: 16px;     /* taille du mot "Frais" */
  font-weight: 500;
  color: #333;
}

/* Label "Frais" */
.cart-fees .fees-label {
  font-size: inherit;
  font-weight: inherit;
  color: inherit;
}

/* --- Cercle avec le "i" --- */
.cart-fees .fees-info {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 16px;                /* largeur du cercle */
  height: 16px;               /* hauteur du cercle */
  border-radius: 50%;         /* cercle parfait */
  border: 2px solid #aaa;     /* couleur et √©paisseur du contour */
  background-color: #fff;     /* fond du cercle */
  font-size: 15px;            /* taille de la lettre "i" */
  color: #aaa;                /* couleur de la lettre "i" */
  line-height: 1;             /* √©vite le d√©calage vertical */
  cursor: default;            /* curseur neutre */
}


/* Le "i" */
.cart-fees .info-icon {
  font-size: 14px;
  color: #aaa;
  line-height: 1;
  font-weight: bold;
}


.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 9999;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  max-width: 400px;
  width: 90%;
  text-align: center;
}


/* --- POPUP FRAIS --- */
#feesModal .modal-content {
  max-width: 320px;     /* üëà largeur r√©duite */
  padding: 18px 20px;
  border-radius: 12px;
  text-align: left;
  padding-bottom: 35px !important;
}

#feesModal h2 {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 18px;
}

/* Retirer les lignes de s√©paration */
#feesModal hr {
  display: none;
}

/* Espacer les blocs Service / Livraison */
#feesModal .fee-block {
  margin-bottom: 22px;
}

#feesModal .fee-block div {
  display: flex;
  justify-content: space-between;
  font-weight: 600;
  margin-bottom: 6px;
}

#feesModal .fee-block p {
  font-size: 14px;
  color: #555;
  margin: 0;
}

/* Total des frais */
#feesModal .total-fees {
  display: flex;
  justify-content: space-between;
  font-weight: 700;
  font-size: 16px;
  margin-top: 15px !important;
}

/* Service */
.cart-service {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
}
.cart-service span:last-child {
  margin-left: auto;
  text-align: right;
}

/* Livraison */
.cart-line {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
}

.cart-divider {
  border: none;
  border-top: 1px solid #ddd; /* fine ligne grise */
  margin: 20px 0;             /* espace autour de la ligne */
}

/* Texte "Total" */
.cart-line:has(#cartTotalAmount) .cart-label {
  font-size: 20px;
  font-weight: 700;
  color: #000;
}

/* Montant "Total" (√† droite) */
#cartTotalAmount {
  font-size: 20px;
  font-weight: 700;
  color: #000;
}






/* Bouton Commander dans le panier */
.btn-commander {
  width: 100%;
  background: #000;     /* fond noir */
  color: #fff;          /* texte blanc */
  font-size: 16px;
  font-weight: bold;
  padding: 14px 0;
  margin-top: 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}

.btn-commander:hover {
  background: #333;
}

.btn-commander:active {
  transform: scale(0.98);
}

.cart-note {
  margin-top: 10px;
  font-size: 13px;
  color: #555;
  text-align: center;
}



html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}

body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

main {
  flex: 1;
}

/* Footer */
footer {
  border-top: 1px solid #ddd; /* fine ligne de s√©paration */
  padding: 30px 0; 
  color: #666; 
  font-size: 14px;
  background: #fff;
 position: relative;
}

footer .container {
  max-width: 1200px;  /* m√™me largeur que la banni√®re et le contenu */
  margin: 0 auto;     /* centre le bloc */
  padding: 0 20px;    /* petit padding horizontal */
}

.fcols {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr 1fr;
  gap: 30px;
}

.fcols a{
display:block;
color:var(--muted);
margin: 10px 0;
text-decoration: none;
}

.copy {
  margin-top: 15px;
  font-size: 13px;
  color: #999;
}
footer .brand b {
  font-size: 18px; 
  color: #000; /* ou la couleur de ton choix */
}

footer .brand + div {
  font-size: 14px;
  color: #666;
  margin-bottom: 10px;
}


/* Modal global */
#extraFeesModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

/* Contenu du pop-up */
#extraFeesModal .modal-content {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  max-width: 460px;
  text-align: center;
  font-size: 14px;
}

/* En-t√™te modal */
#extraFeesModal .modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

#extraFeesModal .modal-header h3 {
  font-size: 30px !important;
  margin: 0;
  color: #000;
}

#extraFeesModal .modal-header .close-btn {
  font-size: 30px;
  font-weight: bold;
  color: #000;
  cursor: pointer;
}

/* Style du titre dans le modal */
#extraFeesModal .modal-content h3 {
  font-size: 18px;
  font-weight: 700;
  color: #000;
  text-align: left;   /* align√© √† gauche */
  margin-bottom: 3px;
}

/* Style du texte dans le modal */
#extraFeesModal .modal-content p {
  font-size: 14px;
  line-height: 1.5;
  color: #444;
  text-align: left;   /* align√© √† gauche */
  margin: 0;          /* supprime les marges inutiles */
}


#extraFeesModal .commitment h3 {
  font-size: 18px !important;
  font-weight: 700;
  color: #000; /* rouge pour diff√©rencier */
  margin-bottom: 8px;
}

#extraFeesModal .commitment p {
  font-size: 14px;
  line-height: 1.5;
  color: #333;
  margin: 0;
}

/* Animation panier quand on ajoute un produit */
.cart-btn.shake {
  animation: shakeCart 0.3s ease;
}

@keyframes shakeCart {
  0%   { transform: scale(1); }
  25%  { transform: scale(1.2) rotate(-5deg); }
  50%  { transform: scale(1.2) rotate(5deg); }
  75%  { transform: scale(1.2) rotate(-5deg); }
  100% { transform: scale(1); }
}

.toast {
  position: fixed;
  top: 80px;              /* au lieu de bottom */
  left: 50%;
  transform: translateX(-50%);
  background: #333;
  color: #fff;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 14px;
  display: none;
  z-index: 9999;
}

.toast span {
  cursor: pointer;
  margin-left: 10px;
  text-decoration: underline;
}


.footer-support {
  position: absolute;
  bottom: 10px;   /* colle en bas */
  right: 20px;    /* colle √† droite */
  text-align: right;
  font-size: 14px;
  color: #000;
}
#deliveryModal button {
  background: #f5f5f5;       /* fond gris clair */
  color: #222;               /* texte sombre */
  font-size: 16px;
  font-weight: 600;
  padding: 12px 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  cursor: pointer;
  width: 100%;
  max-width: 250px;
  margin-top: 15px;
  transition: background 0.2s ease, transform 0.1s ease;
}

#deliveryModal button:hover {
  background: #e0e0e0;       /* gris un peu plus fonc√© au hover */
}

#deliveryModal button:active {
  transform: scale(0.97);    /* petit effet click */
}



/* Modal centr√© */
.delivery-modal {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  justify-content: center;
  align-items: center;
}

.delivery-modal-content {
  background: #fff;
  border-radius: 16px;
  padding: 20px;
  width: 90%;
  max-width: 600px;
  animation: fadeIn 0.3s ease;
}

.delivery-modal-header {
  display: flex;
  flex-direction: column;  /* empile verticalement */
  align-items: flex-start; /* aligne √† gauche */
  position: relative;
  margin-bottom: 20px;
}

.delivery-modal-header h3 {
  margin: 10px 0 0 0;  /* petit espace sous la croix */
  font-size: 25px;
  font-weight: 600;
}

.delivery-close-btn {
  align-self: flex-start; /* force √† gauche */
  font-size: 22px;
  font-weight: bold;
  cursor: pointer;
  color: #333;
  padding: 5px 10px;
  transition: color 0.2s;
}

.delivery-close-btn:hover {
  color: #e74c3c;
}
#delivery-days-wrapper {
  display: flex;
  align-items: center;
  width: 100%;
  position: relative;
  overflow: hidden; /* masque ce qui sort */
}

.days-arrow {
  background: #f5f5f5;
  border: 1px solid #ddd;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 16px;
}

.days-arrow:hover {
  background: #e0e0e0;
}
.days-container {
  display: flex;
  gap: 12px;
  transition: transform 0.3s ease;
  will-change: transform;
  overflow: hidden;   /* üëà c‚Äôest ici qu‚Äôon masque l‚Äôexc√©dent */
  flex: 1;           /* prend toute la largeur dispo entre les fl√®ches */
}

.days-container::-webkit-scrollbar {
  height: 6px;
}
.days-container::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 3px;
}
/* Bloc jour */
.day-block {
  flex: 0 0 115px;       /* largeur ajust√©e */
  background: #fff;   /* gris clair */
  border: 1.5px solid #ddd; 
  border-radius: 12px;
  padding: 12px;
  text-align: left;      /* texte align√© √† gauche */
  cursor: pointer;
  transition: border-color 0.2s ease;
}

.day-block strong {
  display: block;
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

.day-block span {
  font-size: 13px;
  color: #666;
}


/* S√©lectionn√© ‚Üí contour noir */
.day-block.active {
  border-color: #000;
  background: #fff;
  color: #000;
}

.day-block.active strong,
.day-block.active span {
  color: #000;
}

.slots-container {
  margin-top: 20px;
  max-height: 240px;  /* ~5-6 cr√©neaux visibles (09h‚Äì14h) */
  overflow-y: auto;   /* scroll vertical */
  padding: 8px 12px;
  background: #fff;
}

/* scroll plus fin et discret */
.slots-container::-webkit-scrollbar {
  width: 6px;
}
.slots-container::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 3px;
}

.slot-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 0;
  font-size: 16px;
  font-weight: 500;
  color: #222;
}

.slot-row span {
  font-size: 16px;
  color: #222;
}

/* ‚úÖ Checkbox ronde custom */
.slot-row input[type="checkbox"] {
  appearance: none;           
  -webkit-appearance: none;
  -moz-appearance: none;
  width: 20px;
  height: 20px;
  border: 2px solid #555;
  border-radius: 50%;
  cursor: pointer;
  position: relative;
  transition: all 0.2s ease;
}

.slot-row input[type="checkbox"]:checked {
  background-color: #000;
  border-color: #000;
}

.slot-row input[type="checkbox"]:checked::after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  transform: translate(-50%, -50%) scale(1);
  transition: all 0.2s ease;
}

.slots-container hr {
  border: none;
  border-top: 1px solid #e0e0e0; /* gris l√©ger uniforme */
  margin: 4px 0;
}

.delivery-actions {
  display: flex;
  flex-direction: column; /* üëâ empile verticalement */
  gap: 10px;
  margin-top: 20px;
}

.delivery-actions button {
  width: 100%;
  padding: 12px 0;
  border: none;
  border-radius: 8px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}

/* Bouton Enregistrer (en haut) */
.delivery-actions .btn-save {
  background: #000;
  color: #fff;
}
.delivery-actions .btn-save:hover {
  background: #333;
}

/* Bouton Annuler (en dessous) */
.delivery-actions .btn-cancel {
  background: #f5f5f5;
  color: #333;
  border: 1px solid #ddd;
}
.delivery-actions .btn-cancel:hover {
  background: #e0e0e0;
}

.delivery-actions button:active {
  transform: scale(0.97);
}

#toast-container-delivery {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 9999;
}

.toast-delivery {
  background: #4CAF50;
  color: #fff;
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 14px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  opacity: 0;
  transform: translateY(-20px);
  transition: opacity 0.4s ease, transform 0.4s ease;
  margin-top: 10px;
}
.toast-delivery.show {
  opacity: 1;
  transform: translateY(0);
}
.toast-delivery.error {
  background: #e53935;
}


/* Conteneur du badge partenaire dans la banni√®re */
#store-badges {
  position: absolute;
  top: 15px;
  left: 15px;
  z-index: 10;
}

/* Style du badge */
.badge-partenaire {
  display: inline-block;
  background-color: #007bff;
  color: #fff;
  font-size: 13px;
  font-weight: 600;
  padding: 5px 10px;
  border-radius: 14px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.partner-note {
  font-size: 12px;
  color: #666;
  margin: -5px 0 10px;
  line-height: 1.4;
}



.store-search-bar {
  display: flex;
  justify-content: flex-end;
  margin: -18px 0 20px;
}

.search-wrapper {
  position: relative;
  width: 270px; /* ‚úÖ largeur fix√©e ici */
}

.search-wrapper input {
  width: 100%;  /* ‚úÖ l‚Äôinput prend 100% de la largeur du wrapper */
  padding: 9px 12px;
  font-size: 1rem;
  border: 1px solid #ccc;
  border-radius: 40px;
  box-sizing: border-box;
}

#suggestions-box {
  position: absolute;
  top: calc(100% + 6px);
  right: 0;
  width: 270px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  max-height: 250px;
  overflow-y: auto;
  z-index: 2000;
  display: none;
}

.suggestion-item {
  padding: 10px 14px;
  cursor: pointer;
  border-bottom: 1px solid #eee;
}

.suggestion-item:last-child {
  border-bottom: none;
}

.suggestion-item:hover {
  background: #f9f9f9;
}

/* Section r√©sultats */
#search-results {
  margin-top: 25px;
}

#search-results h2 {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 15px;
}

/* Grille 4 colonnes */
.search-results-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 15px;
}

</style>
</head>
<body>
<script>
async function checkAuth() {
  try {
    const res = await fetch("/api/users/me", { credentials: "include" });
    if (!res.ok) throw new Error("Not connected");
    return await res.json(); // ‚úÖ user connect√©
  } catch (err) {
    // ‚ùå Pas connect√© ‚Üí redirige vers la home avec un param√®tre
    window.location.href = "/index.html?openAuth=1";
  }
}
  
// ‚úÖ bloque d√®s le d√©but si pas connect√©
document.addEventListener("DOMContentLoaded", async () => {
  await checkAuth();
});
</script>

<main>


<header>
 <div class="container nav">
    <div class="left-group">
      <!-- Burger menu -->
      <button id="userMenuBtn" class="burger-btn">‚ò∞</button>
      
      <!-- Logo -->
      <a class="brand" href="index.html">
        <div class="brand-badge">‚ö°Ô∏è</div>
        <div>
          <div style="font-size:18px;letter-spacing:-.3px">FlashBring</div>
        </div>
      </a>

      <!-- üëâ Adresse utilisateur (inject√©e par JS) -->
      <div id="userAddress" class="user-address"></div>
    </div>
      
    <!-- Panier -->
    <button id="btnCart" class="cart-btn">
      <i class="fas fa-shopping-cart"></i>
      <span id="cartCount" class="cart-badge">0</span>
    </button>
</div>


<!-- Overlay gris derri√®re le side cart -->
<div id="sidebarOverlay" class="sidebar-overlay"></div>


<!-- üëâ Le vrai conteneur du side cart -->
<div id="userSidebar" class="sidebar">
<div class="sidebar-user">
  <div id="sidebarName">
    Bonjour
  </div>
<a href="/account.html" class="manage-account">G√©rer le compte</a>
</div>

<ul class="sidebar-links">
    <li><a href="/#orders">Mes commandes</a></li>
    <li><a href="/cart.html">Mon panier</a></li>
    <li><a href="/#favorites">Favoris</a></li>
    <li><a href="/#refer">Parrainer</a></li>
    <li><a href="/#faq">Aide</a></li>
    <li><a href="/#settings">Param√®tres</a></li>
    <li><a href="#" id="logoutBtn">Se d√©connecter</a></li>

    <!-- S√©paration fine -->
    <li style="border-top:2px solid #eee; margin:10px 0"></li>

    <!-- Nouveaux liens -->
    <li><a href="/#partners">Ajouter votre restaurant</a></li>
    <li><a href="/#drivers">Inscrivez-vous pour livrer</a></li>
</ul>
</div> <!-- ferme .sidebar -->




<!-- üëâ Sidecart Panier -->
<div id="cartSidebar" class="cart-sidebar">
<!-- üëâ Menu contextuel du panier -->
<ul id="cartContextMenu" style="
  display:none;
  position:absolute;
  right:10px;
  top:60px;
  background:#fff;
  border:1px solid #ddd;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
  list-style:none;
  padding:8px 0;
  margin:0;
  z-index:1000;
">
  <li id="clearCartBtn" style="color:red; cursor:pointer; padding:8px 16px; display:flex; align-items:center; gap:8px;">
    <i class="fas fa-trash"></i> Vider le panier
  </li>
</ul>
  <div class="cart-header">
    <h2>Votre panier</h2>
    <span id="closeCart" class="close-cart">&times;</span>
<button id="cartMenuBtn" class="cart-dots">
  <i class="fas fa-ellipsis-h"></i>
</button>
</div>
<div class="cart-body">
  <!-- Infos du store -->
  <div class="cart-store-info" id="cartStoreInfo" style="display:none; margin-bottom:15px;">
    <img id="cartStoreImg" src="" alt="logo" 
         style="width:50px; height:50px; border-radius:50%; object-fit:cover; margin-bottom:6px;">
    <div>
      <h3 id="cartStoreName" style="margin:0; font-size:15px;"></h3>
      <p id="cartStoreAddress" style="margin:0; font-size:13px; color:#555;"></p>
    </div>
  </div>

<div class="cart-accordion">
  <button class="accordion-toggle" id="cartAccordionBtn">
    <i class="fas fa-shopping-cart"></i>
    <span id="cartAccordionLabel">R√©capitulatif du panier</span>
    <span id="cartAccordionArrow" style="margin-left:auto;">
      <i class="fas fa-chevron-down"></i>
    </span>
  </button>
  <div class="accordion-content">
    <ul id="cartItems" style="list-style:none; padding:0; margin:0;"></ul>
  </div>
</div>



<div class="cart-total">
  <span>Total de la commande</span>
</div>
<div class="cart-subtotal">
  <span>Sous-total</span>
<span id="cartSubtotalAmount" class="subtotal-value">0,00 ‚Ç¨</span>
</div>
<div class="cart-fees">
  <span class="fees-label">Frais</span>
  <span class="fees-info" id="feesInfoBtn">
    <span class="info-icon">i</span>
  </span>
</div>

<!-- Popup Frais -->
<div id="feesModal" class="modal">
  <div class="modal-content">
    <h2>Ce que comprennent les frais</h2>
    <hr>

    <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:6px;">
      <span>Service</span>
      <span id="popupServiceAmount">0,00 ‚Ç¨</span>
    </div>
    <p style="font-size:14px; color:#555; margin-bottom:15px;">
      Ces frais varient en fonction de facteurs tels que la taille du panier et aident √† couvrir les co√ªts li√©s √† votre commande.
    </p>

    <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:6px;">
      <span>Livraison</span>
      <span id="popupDeliveryAmount">0,00 ‚Ç¨</span>
    </div>
    <p style="font-size:14px; color:#555; margin-bottom:15px;">
      Les frais de livraison sont d√©di√©s au livreur et couvrent son d√©placement ainsi que les kilom√®tres suppl√©mentaires.
    </p>

    <hr>
    <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:16px;">
      <span>Total des frais</span>
      <span id="popupTotalFees">0,00 ‚Ç¨</span>
    </div>
  </div>
</div>

<div class="cart-service">
  <span>Service</span>
  <span id="serviceAmount">0,00 ‚Ç¨</span>
</div>  
<div class="cart-line">
  <span class="cart-label">Livraison</span>
  <span id="deliveryAmount">0,00 ‚Ç¨</span>  
</div>

<hr class="cart-divider"> <!-- üëà S√©parateur ajout√© -->

<div class="cart-line">
  <span class="cart-label">Total</span>
  <span id="cartTotalAmount">0,00 ‚Ç¨</span>
</div>


<!-- üëâ Bouton Commander -->
<div class="cart-actions">
  <button id="checkoutBtn" class="btn-commander">Commander</button>
</div>
<p class="cart-note">Paiement s√©curis√© ‚Ä¢ Annulation gratuite avant pr√©paration</p>

<!-- Panier vide -->
<p id="emptyCart" style="text-align:center; color:#777;">Votre panier est vide</p>


</div>
</div>

</header>



<!-- BANNI√àRE -->
<div class="store-banner" id="store-banner">
<div id="store-badges"></div> <!-- badge ins√©r√© dynamiquement --> 
 <div class="banner-actions">
    <!-- Ic√¥ne contour (far = vide, fas = rempli) -->
    <button id="favoriteBtn" class="action-btn">
      <i class="far fa-heart"></i>
    </button>

<button id="menuBtn" class="action-btn"><i class="fas fa-ellipsis-h"></i></button>
  </div>


<!-- üëâ petit menu -->
<div class="context-menu" id="contextMenu">
<a href="#" id="shareStoreBtn">
    <i class="fas fa-share"></i>
    Partager
  </a>
  <div class="menu-separator"></div>
  <a href="#">
    <i class="fas fa-flag"></i>
    Signaler
  </a>
  <div class="menu-separator"></div>
  <a href="#">
    <i class="fas fa-info-circle"></i>
    <div class="info-texts">
      <span>Informations sur l‚Äô√©tablissement</span>
      <small>Adresse, note et plus</small>
    </div>
  </a>  
</div>

</div>


<div id="shareToast" class="toast">
  Lien copi√©   <span id="closeToast">Fermer</span>
</div>




<!-- üëâ Popup Informations √©tablissement -->
<div id="infoPopupOverlay" class="popup-overlay"></div>
<div id="infoPopup" class="info-popup">

  <!-- Bouton fermer -->
  <button id="closeInfoPopup" class="close-btn">‚úï</button> 

  <h2 id="infoStoreName">Nom de l‚Äôenseigne</h2>
  <hr>

  <div class="info-row">
    <i class="fas fa-map-marker-alt"></i>
    <span id="infoStoreAddress">Adresse du magasin</span>
  </div>
  <hr>

  <div class="info-row accordion">
    <i class="fas fa-clock"></i>
    <span>Horaires d‚Äôouverture</span>
    <!-- Accord√©on (vide pour l‚Äôinstant) -->
    <div class="accordion-content" id="infoStoreHours"></div>
  </div>
  <hr>

  <div class="info-row">
    <i class="fas fa-star"></i>
    <span id="infoStoreRating">4,7 (123+ notes)</span>
  </div>
  <hr>

  <div class="info-row">
    <span>Paiements accept√©s : Carte de cr√©dit (Visa, MasterCard, Amex), Google/Apple Pay</span>
  </div>
 
<hr>
<div class="legal-info">
  <p><strong id="popupStoreName"></strong></p>
  <p id="popupStoreAddress"></p>
  <p>"Ce commer√ßant certifie que ses produits sont conformes aux lois en vigueur."</p>
  <p id="popupStoreEmail">@gmail.com</p>
<p id="legalPhone">+33 X XX XX XX XX</p>
  <p>Chambre de Commerce et d‚ÄôIndustrie (CCI)<br>XXXXXXXXXXXXXX</p>
  <p class="allergy-warning">
    Si vous souffrez d'allergies alimentaires ou si vous suivez un r√©gime alimentaire sp√©cifique,
    veuillez en aviser directement le restaurant avant de passer votre commande.
  </p>
</div>
</div>



<div class="store-layout">
  <!-- INFOS STORE √Ä GAUCHE -->
  <div class="store-info">
    <div class="store-top-line">
      <h1 id="store-name">Nom de l‚Äôenseigne</h1>
<p class="partner-note"></p>   
 <div class="store-meta" id="store-meta"></div>
    <div class="store-meta" id="store-payments"></div>
<div class="store-meta">Appuyez pour consulter les horaires, les informations, etc.</div>    
<div class="store-address" id="store-address"></div>

 </div>

  <!-- Bloc scrollable uniquement -->
  <div class="categories-scroll">

<ul class="store-categories" id="store-categories">
  <li class="category-item active" data-target="cat-Articles-en-vedette">Articles en vedette</li>
  <li class="category-item" data-target="cat-Commandez-de-nouveau">Commandez de nouveau</li>
  <li class="category-item" data-target="cat-Notre-s√©lection-pour-vous">Notre s√©lection pour vous</li>
  <li class="category-item" data-target="cat-Fruit-et-l√©gumes">Fruit et l√©gumes</li>
  <li class="category-item" data-target="cat-Eaux-Sodas">Eaux, Sodas</li>
  <li class="category-item" data-target="cat-Fromagerie">Fromagerie</li>
  <li class="category-item" data-target="cat-Petits-prix">Petits prix</li>
  <li class="category-item" data-target="cat-Repas-express">Repas express</li>
  <li class="category-item" data-target="cat-Pains-et-p√¢tisseries">Pains et p√¢tisseries</li>
  <li class="category-item" data-target="cat-Biscuits-et-go√ªter">Biscuits et go√ªter</li>
  <li class="category-item" data-target="cat-Ap√©rtif-dinatoire">Ap√©ritif dinatoire</li>
  <li class="category-item" data-target="cat-Laitage-et-Produits-frais">Laitage et Produits frais</li>
  <li class="category-item" data-target="cat-Charcuterie">Charcuterie</li>
  <li class="category-item" data-target="cat-Surgel√©s">Surgel√©s</li>
  <li class="category-item" data-target="cat-Yaourts-et-Desserts">Yaourts et Desserts</li>
  <li class="category-item" data-target="cat-Confiseries">Confiseries</li>
  <li class="category-item" data-target="cat-Boissons-chaudes">Boissons chaudes</li>
  <li class="category-item" data-target="cat-P√¢tes-Riz-et-F√©culents">P√¢tes, Riz et F√©culents</li>
  <li class="category-item" data-target="cat-Hygi√®ne">Hygi√®ne</li>
  <li class="category-item" data-target="cat-Boucherie">Boucherie</li>
  <li class="category-item" data-target="cat-Sauces">Sauces</li>
  <li class="category-item" data-target="cat-Cave-et-bi√®res">Cave et bi√®res</li>
  <li class="category-item" data-target="cat-Petit-d√©jeuner">Petit d√©jeuner</li>
  <li class="category-item" data-target="cat-Parapharmacie">Parapharmacie</li>
  <li class="category-item" data-target="cat-Volaille-et-r√¥tisserie">Volaille et r√¥tisserie</li>
  <li class="category-item" data-target="cat-Conserves-et-bocaux">Conserves et bocaux</li>
  <li class="category-item" data-target="cat-Maison">Maison</li>
  <li class="category-item" data-target="cat-Poissonnerie">Poissonnerie</li>
  <li class="category-item" data-target="cat-Monde-de-b√©b√©">Monde de b√©b√©</li>
</ul>
    </div>
</div>

<!-- CONTENU √Ä DROITE -->
<div class="store-content" id="store-content">


<!-- Barre de recherche -->
<div class="store-search-bar">
<div class="search-wrapper">
  <input type="text" id="store-search-input" placeholder="">
<div id="suggestions-box"></div>
</div>
</div>
<!-- Bloc infos livraison -->
<div class="delivery-block">
  <div class="delivery-info">
<span id="delivery-fee">Frais de livraison : ‚Äî</span>
    <span class="separator">|</span>
    <span id="delivery-time">20‚Äì30 min</span>
  </div>

<div class="extra-fees">
  <span class="fees-label">
    Autres frais
    <span class="info-icon">i</span>
  </span>
<button id="modifyDeliveryBtn" class="btn-modify">Modifier</button>
</div>
</div>

<!-- Modal Autres frais -->
<div id="extraFeesModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Autres frais</h3>
      <span id="closeExtraFees" class="close-btn">&times;</span>
    </div>
<h3>Frais de livraison</h3>
<p>
Les frais de livraison varient selon votre lieu de livraison.
Ils sont affich√©s de fa√ßon transparente sur chaque vitrine de restaurant ou de commer√ßant, ainsi qu‚Äôavant de confirmer votre commande.
    </p>
<h3>Frais de service</h3>
<p>
Ces frais servent √† couvrir les co√ªts li√©s √† la pr√©paration et au suivi de votre commande.
Ils varient notamment selon la taille du panier et vous sont indiqu√©s en toute transparence avant de confirmer votre commande.
</p>
<div class="commitment">
<h3>Notre engagement</h3>
<p>
Chez FlashBring, nous avons choisi un mod√®le plus juste :  
  nos livreurs re√ßoivent une r√©mun√©ration plus √©lev√©e pour chaque course,  
  tout en maintenant des frais plus bas pour nos clients.  
  Comment ? Nous r√©duisons volontairement notre marge afin de privil√©gier  
  la satisfaction de ceux qui comptent le plus : nos clients, nos commer√ßants  
  et nos livreurs.
</p>
</div>

</div>
</div>

<!-- Modal Modifier Livraison -->
<div id="deliveryModalCustom" class="delivery-modal">
  <div class="delivery-modal-content">
    <div class="delivery-modal-header">
      <span id="closeDeliveryModalCustom" class="delivery-close-btn">&times;</span>
      <h3>Planifier une livraison</h3>
    </div>

    <div id="delivery-days-wrapper">
      <!-- Fl√®che gauche -->
      <button id="prevDaysBtn" class="days-arrow">
        <i class="fas fa-chevron-left"></i>
      </button>

      <!-- Jours -->
      <div id="delivery-days" class="days-container"></div>

      <!-- Fl√®che droite -->
      <button id="nextDaysBtn" class="days-arrow">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
<!-- Conteneur des horaires -->
    <div id="delivery-slots" class="slots-container"></div>
<div class="delivery-actions">
 <button class="btn-save">Enregistrer</button>
  <button class="btn-cancel">Annuler</button>
</div> 
 </div>
</div>

<div id="products-container"></div>  


<!-- POPUP PRODUIT -->
<div id="popup-overlay" class="popup-overlay" style="display: none;">
  <div class="popup-content">
    <!-- Bouton fermer -->
    <span class="close" onclick="closePopup()">&times;</span>

    <!-- Image gauche -->
    <div class="popup-left">
      <img id="popup-img" src="" alt="Produit">
    </div>

    <!-- Contenu droite -->
    <div class="popup-right">
      <h2 id="popup-title"></h2>
      <p id="popup-price"></p>

<div id="popup-quantity">
  <div class="select-wrapper">
    <select id="popup-quantity-select"></select>
  </div>
</div>

      <!-- Bouton -->
      <div class="popup-footer">
      <button id="popup-add-btn">Ajouter au panier - <span id="popup-total">0.00 ‚Ç¨</span></button>
      </div>

      <!-- Description -->
      <p id="popup-desc" class="popup-desc"></p>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  try {  
 const res = await fetch("/api/users/me", { credentials: "include" });
    if (res.ok) {
      const user = await res.json();
      console.log("Connect√© en tant que :", user.email);
      window.currentUser = user;
    
      // üîπ Injecter le pr√©nom
      const sidebarName = document.getElementById("sidebarName");
      if (sidebarName) {
        const prenom = user.firstname || user.name || "";
        sidebarName.textContent = `Bonjour ${prenom}`;
      }

      // üîπ R√©cup√©rer l'ID du store dans l'URL
      const params = new URLSearchParams(window.location.search);
      const storeId = params.get("id");

      // ‚úÖ Charger le panier du store si on est dans une page "store"
      if (typeof loadCart === "function") {
        if (storeId) {
          await loadCart(storeId); // on lui passe le store
        } else {
          await loadCart(); // page cart.html ‚Üí global
        }
      }

    } else {
      console.warn("Pas connect√© ‚Üí redirection vers login");
      window.location.href = "/index.html";
    }
  } catch (err) {
    console.error("Erreur auth:", err);
  }
});
</script>
<script>
async function loadStore() {
  const params = new URLSearchParams(window.location.search);
  const storeId = params.get("id") || 1;

  try {
    // üîπ R√©cup√©rer la position client depuis /api/users/me
const resUser = await fetch("/api/users/me", { credentials: "include" });
    let lat, lng;
    if (resUser.ok) {
      const user = await resUser.json();
      lat = user.lat;
      lng = user.lng;
    }

    // üîπ Construire l‚ÄôURL de l‚ÄôAPI store
    let url = `/api/stores/${storeId}`;
    if (lat && lng) url += `?lat=${lat}&lng=${lng}`;

    const res = await fetch(url);
    const store = await res.json();

    window.storeData = store; // rend accessible partout
    checkDeliveryZone(store); // üëà garde ta v√©rif de zone

    // --- Extraire ville proprement
    let city = "";
    if (store.address) {
      const afterComma = store.address.split(",").pop().trim();
      city = afterComma;
    }

document.title = `${store.name} Vos courses du quotidien - Livraison √† ${city} | Flashbring`;

const metaDesc = document.querySelector('meta[name="description"]');
if (metaDesc) {
  metaDesc.setAttribute(
    "content",
    `Commandez ${store.name} en livraison √† ${city}. Consultez le menu, les prix et profitez d'une livraison rapide avec Flashbring.`
  );
}

  // Banni√®re
    const banner = document.getElementById("store-banner");
    if (store.banner_url) {
      banner.style.backgroundImage = `url(${store.banner_url})`;
    }
      
    // Nom
    document.getElementById("store-name").textContent = store.name;
       
// ‚úÖ Badge partenaire OU note l√©gale
const badgeWrapper = document.getElementById("store-badges");
const legalNote = document.querySelector(".partner-note");

if (store.is_partner) {
  // Affiche badge
  if (badgeWrapper) {
    badgeWrapper.innerHTML = `<span class="badge-partenaire">Partenaire</span>`;
  }
  // Cache la phrase l√©gale
  if (legalNote) {
    legalNote.textContent = "";
  }
} else {
  // Pas de badge
  if (badgeWrapper) {
    badgeWrapper.innerHTML = "";
  }
  // Affiche la phrase l√©gale
  if (legalNote) {
    legalNote.textContent =
      "Sans badge Partenaire, l‚Äôenseigne n‚Äôest pas affili√©e. Nom affich√© √† titre informatif.";
  }
}


    // Placeholder dynamique  
    document.getElementById("store-search-input").placeholder = `Rechercher dans ${store.name}`;
        
// ‚úÖ Frais calcul√©s par le backend
const deliveryFee = store.delivery_fee
  ? `${store.delivery_fee.toFixed(2)} ‚Ç¨`
  : "‚Äî";
    
document.getElementById("store-meta").innerHTML =
  `‚≠ê ${store.rating || "N/A"} (${store.review_count || 0}+) ‚Ä¢ Frais de livraison : ${deliveryFee}`;
    
    document.getElementById("delivery-fee").textContent =
      `Frais de livraison : ${deliveryFee}`;
      
// ‚úÖ Temps de livraison estim√© avec le m√™me calcul que backend (plage dynamique)
if (lat && lng && store.lat && store.lng) {
  const prepTime = 15; // minutes pr√©paration
  const buffer = 6;    // marge de s√©curit√©

  const dist = getDistanceKm(lat, lng, store.lat, store.lng);

  // m√™me logique que backend
  const speed = "scooter" === "bike" ? 5 : 3; 
  const travelTime = dist * speed;

  const est = Math.round(prepTime + travelTime + buffer);

  // üëâ g√©n√®re une tranche dynamique ¬±3 min autour de est
  const min = Math.max(est - 3, 10);
  const max = est + 3;

  document.getElementById("delivery-time").textContent = `${min}‚Äì${max} min`;
} else {
  document.getElementById("delivery-time").textContent = "‚Äî";
}


    // Paiements
    document.getElementById("store-payments").textContent =
      `Paiements accept√©s : ${store.payments || "Carte de cr√©dit (Visa, MasterCard, Amex), Google/ Apple Pay"}`;
    
    // Adresse
    document.getElementById("store-address").textContent = store.address || "";
      
  } catch (err) {
    console.error("Erreur chargement store:", err);
  } 
}
    
loadStore();
</script>


<script>
// Sauvegarde globale des produits
let allProducts = [];
let bestsellerProducts = [];
let reorderProducts = [];
let categoryPageIndex = {}; // index par cat√©gorie

async function loadProducts(storeId) {
  try {
    // Charger tous les produits du store
    const res = await fetch(`/api/products?store_id=${storeId}`);
    allProducts = await res.json(); // on garde tous les produits

    // Charger aussi les bestsellers
    try {
const resBest = await fetch(`/api/products/bestsellers?store_id=${storeId}`);
      if (resBest.ok) {
        bestsellerProducts = await resBest.json();
      }
    } catch (err) {
      console.error("Erreur chargement bestsellers:", err);
    }

// Charger aussi "Commandez de nouveau"
try {
  const resReorder = await fetch(`/api/products/reorder?store_id=${storeId}`, {
    credentials: "include"   // ‚ö°Ô∏è envoie automatiquement ton cookie JWT
  });

  if (resReorder.ok) {
    reorderProducts = await resReorder.json();
    console.log("üõí Produits reorder re√ßus:", reorderProducts);
  } else {
    console.warn("Erreur reorder:", resReorder.status);
    reorderProducts = []; // ‚ö†Ô∏è pour √©viter crash
  }
} catch (err) {
  console.error("Erreur chargement reorder:", err);
  reorderProducts = [];
}

    // Afficher les produits (y compris Articles en vedette)
    renderProducts(allProducts);
  } catch (err) {
    console.error("Erreur chargement produits:", err);
  }
}

function shuffleArray(array) {
  return [...array].sort(() => Math.random() - 0.5);
}

function renderProducts(products) {
  const categories = [
    { title: "Articles en vedette", filter: p => bestsellerProducts.some(b => b.id === p.id) },
    ...(reorderProducts.length > 0
      ? [{ title: "Commandez de nouveau", custom: reorderProducts }]
      : []
    ),
    { title: "Notre s√©lection pour vous", custom: shuffleArray(allProducts).slice(0, 4) },

    // Cat√©gories avec sous-sections
    { title: "Fruit et l√©gumes", sub: ["Fruits", "L√©gumes"], filter: p => p.category === "fruit_legumes" },
    { title: "Eaux, Sodas", sub: ["Eaux", "Sodas"], filter: p => p.category === "eaux_sodas" },
    { title: "Pains et p√¢tisseries", sub: ["Pains", "P√¢tisseries"], filter: p => p.category === "pains_patisseries" },
    { title: "Biscuits et go√ªter", sub: ["Biscuits", "Go√ªter"], filter: p => p.category === "biscuits_gouter" },
    { title: "Laitage et Produits frais", sub: ["Laitage", "Produits frais"], filter: p => p.category === "laitage_frais" },
    { title: "Yaourts et Desserts", sub: ["Yaourts", "Desserts"], filter: p => p.category === "yaourts_desserts" },
    { title: "P√¢tes, Riz et F√©culents", sub: ["P√¢tes", "Riz", "F√©culents"], filter: p => p.category === "pates_riz_feculents" },
    { title: "Cave et bi√®res", sub: ["Cave", "Bi√®res"], filter: p => p.category === "cave_bieres" },
    { title: "Volaille et r√¥tisserie", sub: ["Volaille", "R√¥tisserie"], filter: p => p.category === "volaille_rotisserie" },
    { title: "Conserves et bocaux", sub: ["Conserves", "Bocaux"], filter: p => p.category === "conserves_bocaux" },

    // Cat√©gories simples
    { title: "Fromagerie", filter: p => p.category === "fromagerie" },
    { title: "Petits prix", filter: p => p.category === "petits_prix" },
    { title: "Repas express", filter: p => p.category === "repas_express" },
    { title: "Ap√©ritif dinatoire", filter: p => p.category === "aperitif_dinatoire" },
    { title: "Charcuterie", filter: p => p.category === "charcuterie" },
    { title: "Surgel√©s", filter: p => p.category === "surgeles" },
    { title: "Confiseries", filter: p => p.category === "confiseries" },
    { title: "Boissons chaudes", filter: p => p.category === "boissons_chaudes" },
    { title: "Hygi√®ne", filter: p => p.category === "hygiene" },
    { title: "Boucherie", filter: p => p.category === "boucherie" },
    { title: "Sauces", filter: p => p.category === "sauces" },
    { title: "Petit d√©jeuner", filter: p => p.category === "petit_dejeuner" },
    { title: "Parapharmacie", filter: p => p.category === "parapharmacie" },
    { title: "Maison", filter: p => p.category === "maison" },
    { title: "Poissonnerie", filter: p => p.category === "poissonnerie" },
    { title: "Monde de b√©b√©", filter: p => p.category === "monde_bebe" }
  ];

  // Reset conteneurs
  const container = document.getElementById("products-container");
  container.innerHTML = "";

  // Menu de gauche
  const menu = document.getElementById("store-categories");
  menu.innerHTML = categories
    .map((cat, i) => `
      <li class="category-item ${i === 0 ? "active" : ""}" 
          data-target="cat-${cat.title.replace(/\s+/g, "-")}">
        ${cat.title}
      </li>
    `)
    .join("");

  // G√©n√®re les sections produits
  categories.forEach(cat => {
    if (!categoryPageIndex[cat.title]) categoryPageIndex[cat.title] = 0;

    const start = categoryPageIndex[cat.title] * 4;
    const end = start + 4;

    let items = [];
    if (cat.custom) {
      items = cat.custom.slice(start, end);
    } else if (cat.filter) {
      items = products.filter(cat.filter).slice(start, end);
    }

    const section = document.createElement("section");
    section.className = "category-block";
    section.id = `cat-${cat.title.replace(/\s+/g, "-")}`;

    // Si la cat√©gorie a des sous-sections ‚Üí on d√©coupe
    if (cat.sub) {
      section.innerHTML = `
        <div class="category-header">
          <h2>${cat.title}</h2>
        </div>
        ${cat.sub.map(subName => `
          <div class="subcategory">
            <h3>${subName}</h3>
            <div class="products-row">
              ${
                items.length > 0
                  ? items.map(p => `
                    <div class="product-card" data-id="${p.id}">
                      <img src="${p.image_url || '/placeholder.png'}" alt="${p.name}">
                      <div class="product-info">
                        <h3>${p.name}</h3>
                        <div class="product-meta">
                          <span class="price">${p.price} ‚Ç¨</span>
                          <span class="orders">(${p.orderCount || 0}+)</span>
                        </div>
                      </div>
                    </div>
                  `).join("")
                  : `<p>Aucun produit disponible</p>`
              }
            </div>
          </div>
        `).join("")}
      `;
    } else {
      // Sinon section classique
      section.innerHTML = `
        <div class="category-header">
          <h2>${cat.title}</h2>
          <div class="arrows">
            <button class="arrow-btn arrow-left" data-cat="${cat.title}">‚Üê</button>
            <button class="arrow-btn arrow-right" data-cat="${cat.title}">‚Üí</button>
          </div>
        </div>
        <div class="products-row">
          ${
            items.length > 0
              ? items.map(p => `
                <div class="product-card" data-id="${p.id}">
                  <img src="${p.image_url || '/placeholder.png'}" alt="${p.name}">
                  <div class="product-info">
                    <h3>${p.name}</h3>
                    <div class="product-meta">
                      <span class="price">${p.price} ‚Ç¨</span>
                      <span class="orders">(${p.orderCount || 0}+)</span>
                    </div>
                  </div>
                </div>
              `).join("")
              : `<p>Aucun produit disponible</p>`
          }
        </div>
      `;
    }

    container.appendChild(section);
  });

  // Navigation fl√®ches
  document.querySelectorAll(".arrow-left, .arrow-right").forEach(btn => {
    btn.addEventListener("click", () => {
      const catTitle = btn.dataset.cat;
      const isRight = btn.classList.contains("arrow-right");

      const cat = categories.find(c => c.title === catTitle);
      if (!cat) return;

      const totalItems = cat.custom ? cat.custom.length : products.filter(cat.filter).length;
      const totalPages = Math.ceil(totalItems / 4);

      if (isRight) {
        if (categoryPageIndex[catTitle] < totalPages - 1) {
          categoryPageIndex[catTitle]++;
          renderProducts(allProducts);
        }
      } else {
        if (categoryPageIndex[catTitle] > 0) {
          categoryPageIndex[catTitle]--;
          renderProducts(allProducts);
        }
      }
    });
  });

  enableProductClick(allProducts);
}

// Lancer le chargement
const params = new URLSearchParams(window.location.search);
const storeId = params.get("id") || 1;   // üëà fallback 1 comme loadStore()
loadProducts(storeId);                    // üëà charge toujours les produits


let currentProduct = null;


// --- POPUP PRODUIT ---
// --- POPUP PRODUIT ---
function openPopup(product) {
  const overlay = document.getElementById("popup-overlay");
  overlay.style.display = "flex";

  // Remplissage des infos
  document.getElementById("popup-img").src = product.image_url || "/placeholder.png";
  document.getElementById("popup-title").textContent = product.name;
  document.getElementById("popup-desc").textContent = product.description || "Pas de description disponible";

  let basePrice = parseFloat(product.price) || 0;
  document.getElementById("popup-price").textContent = `${basePrice.toFixed(2)} ‚Ç¨`;

  // S√©lecteur quantit√©
  const qtyContainer = document.getElementById("popup-quantity");
  qtyContainer.innerHTML = "";

  const select = document.createElement("select");
  select.id = "popup-quantity-select";
  for (let i = 1; i <= 20; i++) {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = i;
    if (i === 1) opt.selected = true;
    select.appendChild(opt);
  }
  qtyContainer.appendChild(select);

  // Init prix total
  const totalSpan = document.getElementById("popup-total");
  function updateTotal() {
    const quantity = parseInt(select.value) || 1;
    const total = basePrice * quantity;
    totalSpan.textContent = `${total.toFixed(2)} ‚Ç¨`;

    // Met √† jour le produit global
    if (window.currentProduct) {
      window.currentProduct.quantity = quantity;
    }
  }
  select.addEventListener("change", updateTotal);
  updateTotal();

  // ‚úÖ Sauvegarde produit courant en global avec id obligatoire
  window.currentProduct = {
    id: product.id,             // üëà important !
    name: product.name,
    basePrice,
    price: basePrice,
    quantity: parseInt(select.value) || 1
  };
}


function closePopup() {
  document.getElementById("popup-overlay").style.display = "none";

  // R√©initialiser le prix affich√©
  document.getElementById("popup-total").textContent = "0.00 ‚Ç¨";

  // R√©initialiser la quantit√©
  const qtyContainer = document.getElementById("popup-quantity");
  if (qtyContainer) qtyContainer.innerHTML = "";

  // Reset infos produit
  document.getElementById("popup-img").src = "/placeholder.png";
  document.getElementById("popup-title").textContent = "";
  document.getElementById("popup-desc").textContent = "";
  document.getElementById("popup-price").textContent = "0.00 ‚Ç¨";

  // Nettoyer le produit courant
  window.currentProduct = null;
}

// Fermer le popup si on clique sur l‚Äôoverlay
document.getElementById("popup-overlay").addEventListener("click", (e) => {
  if (e.target.id === "popup-overlay") {
    closePopup();
  }
});


// Ajout click sur cartes produit apr√®s chaque rendu
function enableProductClick(products) {
  document.querySelectorAll(".product-card").forEach(card => {
    card.addEventListener("click", () => {
      const id = parseInt(card.dataset.id, 10);
      const product = products.find(p => p.id === id);
      if (product) openPopup(product);
    });
  });
}




const userMenuBtn = document.getElementById("userMenuBtn");
const userSidebar = document.getElementById("userSidebar");
const sidebarOverlay = document.getElementById("sidebarOverlay");
const closeUserSidebar = document.getElementById("closeUserSidebar");

function closeSidebar() {
  userSidebar.classList.remove("open");
  sidebarOverlay.classList.remove("active");
}

userMenuBtn.addEventListener("click", () => {
  userSidebar.classList.add("open");
  sidebarOverlay.classList.add("active");
});

if (closeUserSidebar) {
  closeUserSidebar.addEventListener("click", closeSidebar);
}

sidebarOverlay.addEventListener("click", closeSidebar);





// Clique sur une cat√©gorie ‚Üí scroll vers la section correspondante
document.addEventListener("click", (e) => {
  if (e.target.classList.contains("category-item")) {
    const targetId = e.target.dataset.target;
    const target = document.getElementById(targetId);
    if (target) {
      target.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  }
});

// Scrollspy ‚Üí met √† jour la cat√©gorie active en fonction du scroll
window.addEventListener("scroll", () => {
  const sections = document.querySelectorAll(".category-block");
  let current = "";

  sections.forEach(section => {
    const rect = section.getBoundingClientRect();
    if (rect.top <= 150 && rect.bottom > 150) {
      current = section.id;
    }
  });

  if (current) {
    document.querySelectorAll(".category-item").forEach(item => {
      item.classList.remove("active");
      if (item.dataset.target === current) {
        item.classList.add("active");
      }
    });
  }
});

const menuBtn = document.getElementById("menuBtn");
const contextMenu = document.getElementById("contextMenu");

menuBtn.addEventListener("click", (e) => {
  e.stopPropagation(); // emp√™che la propagation
  contextMenu.style.display = 
    contextMenu.style.display === "flex" ? "none" : "flex";
});

// Fermer si on clique ailleurs
document.addEventListener("click", () => {
  contextMenu.style.display = "none";
});



// S√©lecteurs popup
const infoPopup = document.getElementById("infoPopup");
const infoPopupOverlay = document.getElementById("infoPopupOverlay");
const closeInfoPopup = document.getElementById("closeInfoPopup");

// üåç Variables globales carte
let infoMap;
let clientMarker, storeMarker, routeLine;

function showStoreMap(storeData) {
  if (!window.currentUser || !storeData.lat || !storeData.lng) return;

  const clientLatLng = [window.currentUser.lat, window.currentUser.lng];
  const storeLatLng = [storeData.lat, storeData.lng];

  // Init une seule fois
  if (!infoMap) {
    infoMap = L.map("map-container", {
      zoomControl: false,
      dragging: false,
      scrollWheelZoom: false,
      doubleClickZoom: false,
      boxZoom: false,
      keyboard: false,
      touchZoom: false
    }).setView(storeLatLng, 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "¬© OpenStreetMap"
    }).addTo(infoMap);
  }

  // Nettoyage ancien trac√©
  if (clientMarker) infoMap.removeLayer(clientMarker);
  if (storeMarker) infoMap.removeLayer(storeMarker);
  if (routeLine) infoMap.removeLayer(routeLine);

  // Marqueurs
  clientMarker = L.marker(clientLatLng).addTo(infoMap).bindPopup("üìç Vous");
  storeMarker = L.marker(storeLatLng).addTo(infoMap).bindPopup("üè™ Magasin");

  // Ligne bleue
  routeLine = L.polyline([clientLatLng, storeLatLng], { color: "blue" }).addTo(infoMap);

  // Ajuste la vue pour montrer les deux points
infoMap.fitBounds([clientLatLng, storeLatLng], { padding: [30, 30] });


  // Fix dimension carte
  setTimeout(() => infoMap.invalidateSize(), 200);

  // Distance + temps
  const distMeters = infoMap.distance(clientLatLng, storeLatLng);
  const distKm = (distMeters / 1000).toFixed(1);
  const minutes = Math.round(distKm / 0.42); // ~25km/h

  const deliveryEl = document.getElementById("deliveryEstimate");
  if (deliveryEl) deliveryEl.textContent = `${distKm} km ‚Ä¢ ${minutes} min estim√©s`;
}

// Ouvrir quand on clique dans le menu contextuel
document.querySelectorAll(".context-menu a").forEach(link => {
  if (link.textContent.includes("Informations")) {
    link.addEventListener("click", e => {
      e.preventDefault();
      infoPopup.style.display = "block";
      infoPopupOverlay.style.display = "block";

      // ‚ö° infos r√©elles du store
      document.getElementById("infoStoreName").textContent = storeData.name || "Nom non d√©fini";
      document.getElementById("infoStoreAddress").textContent = storeData.address || "Adresse inconnue";

      if (storeData.rating) {
        document.getElementById("infoStoreRating").textContent =
          `${storeData.rating} (${storeData.review_count}+ notes)`;
      } else {
        document.getElementById("infoStoreRating").textContent = "Pas encore not√©";
      }

      // Bloc l√©gal
      document.getElementById("popupStoreName").textContent = storeData.name || "Nom de l‚Äôenseigne";
      document.getElementById("popupStoreAddress").textContent = storeData.address || "Adresse indisponible";
      document.getElementById("popupStoreEmail").textContent = storeData.email || "@gmail.com";
      document.getElementById("legalPhone").textContent = storeData.phone || "+33 X XX XX XX XX";

      // ‚ö° Ajoute la carte + distance/temps
      showStoreMap(storeData);
    });
  }
});

// Fermer popup
closeInfoPopup.addEventListener("click", () => {
  infoPopup.style.display = "none";
  infoPopupOverlay.style.display = "none";
});
infoPopupOverlay.addEventListener("click", () => {
  infoPopup.style.display = "none";
  infoPopupOverlay.style.display = "none";
});




// --- Gestion du sidecart ---
const btnCart = document.getElementById("btnCart");
const cartSidebar = document.getElementById("cartSidebar");
const closeCart = document.getElementById("closeCart");

btnCart.addEventListener("click", () => {
  cartSidebar.classList.add("open");
  sidebarOverlay.classList.add("active"); // r√©utilise ton overlay
});

closeCart.addEventListener("click", () => {
  cartSidebar.classList.remove("open");
  sidebarOverlay.classList.remove("active");
});

sidebarOverlay.addEventListener("click", () => {
  cartSidebar.classList.remove("open");
  sidebarOverlay.classList.remove("active");
});



</script>

<script>
// ===============================
// ‚úÖ Charger le panier par store
// ===============================
async function loadCart(storeId) {
  try {
    // ‚ö° Toujours utiliser le store courant
    storeId = storeId || window.storeData?.id;
    
    if (!storeId) {
      console.warn("‚ö†Ô∏è Impossible de charger le panier : storeId manquant");
      renderCart([]);
      return [];
    }
      
    console.log("üöÄ [FRONT] Chargement panier... (storeId:", storeId, ")");
    
    // üîπ Construire l‚ÄôURL avec store_id obligatoire
    const url = `/api/cart?store_id=${storeId}`;
    
    const res = await fetch(url, { credentials: "include" });
    console.log("üì° /api/cart status:", res.status);
    
    if (!res.ok) {
      console.error("‚ùå Impossible de charger le panier");
      renderCart([]);
      return [];
    }
   const items = await res.json();
    console.log("üõí [FRONT] Panier re√ßu:", items);

    // ‚ö° afficher visuellement
    renderCart(items);
    
    // ‚ö° afficher prix et totaux
    await updateCartTotals(storeId);
    
    return items;
  } catch (err) {
    console.error("‚ö†Ô∏è Erreur loadCart:", err);
    renderCart([]);
    return [];
  }
}   


function renderCart(cart) {
  const cartItems = document.getElementById("cartItems");
  const emptyCart = document.getElementById("emptyCart");
  const cartBadge = document.getElementById("cartCount");

  cartItems.innerHTML = "";

  // Si le panier est vide
  if (!cart || cart.length === 0) {
    emptyCart.style.display = "block";
    cartBadge.textContent = "0";

    // Cache les blocs
document.getElementById("cartStoreInfo").style.display = "none";
    document.querySelector(".cart-accordion").style.display = "none";
    document.querySelector(".cart-total").style.display = "none";
    document.querySelector(".cart-subtotal").style.display = "none";
    document.querySelector(".cart-service").style.display = "none";
    document.querySelectorAll(".cart-line").forEach(el => el.style.display = "none");
    document.querySelector(".cart-fees").style.display = "none";
    document.querySelector(".cart-divider").style.display = "none";
    document.querySelector(".btn-commander").style.display = "none";
    document.querySelector(".cart-note").style.display = "none";

    // reset totaux
    document.getElementById("cartSubtotalAmount").textContent = "0,00 ‚Ç¨";
    document.getElementById("serviceAmount").textContent = "0,00 ‚Ç¨";
    document.getElementById("deliveryAmount").textContent = "0,00 ‚Ç¨";
    document.getElementById("cartTotalAmount").textContent = "0,00 ‚Ç¨";
    return;
  }

  // R√©affiche les blocs
  emptyCart.style.display = "none";
  document.getElementById("cartStoreInfo").style.display = "";
  document.querySelector(".cart-fees").style.display = "";
  document.querySelector(".cart-accordion").style.display = "";
  document.querySelector(".cart-total").style.display = "";
  document.querySelector(".cart-subtotal").style.display = "";
  document.querySelector(".cart-service").style.display = "";
  document.querySelectorAll(".cart-line").forEach(el => el.style.display = "");
  document.querySelector(".cart-divider").style.display = "";
  document.querySelector(".btn-commander").style.display = "";
  document.querySelector(".cart-note").style.display = "";

  // Infos du store
  if (storeData) {
    const storeInfo = document.getElementById("cartStoreInfo");
    storeInfo.style.display = "flex";
    document.getElementById("cartStoreImg").src = storeData.banner_url || "";
    document.getElementById("cartStoreName").textContent = storeData.name || "";
    document.getElementById("cartStoreAddress").textContent = storeData.address || "";
  }

// Affiche infos du store
  if (window.storeData) {
    document.getElementById("cartStoreImg").src = storeData.banner_url || "";
    document.getElementById("cartStoreName").textContent = storeData.name || "";
    document.getElementById("cartStoreAddress").textContent = storeData.address || "";
  }

  // Boucle produits
  let totalItems = 0;
  cart.forEach(item => {
    totalItems += item.quantity;
    const product = item.product;
    if (!product) return;

    const unitPrice = parseFloat(product.price);
    const lineTotal = unitPrice * item.quantity;

    const li = document.createElement("li");
    li.style.display = "flex";
    li.style.alignItems = "center";
    li.style.justifyContent = "space-between";
    li.style.marginBottom = "12px";

    li.innerHTML = `
      <div style="display:flex; align-items:center; gap:10px;">
        <img src="${product.image_url || ""}" alt="${product.name}"
             style="width:50px; height:50px; border-radius:8px; object-fit:cover;">
        <div>
          <p style="margin:0; font-size:14px; font-weight:500;">${product.name}</p>
          <p style="margin:0; font-size:13px; color:#555;">
            ${unitPrice.toFixed(2)} ‚Ç¨
          </p>
        </div>
      </div>
      <div style="text-align:right;">
        <span style="font-size:14px; color:#333;">x${item.quantity}</span><br>
        <span style="font-size:14px; font-weight:600;">${lineTotal.toFixed(2)} ‚Ç¨</span>
      </div>
    `;

    cartItems.appendChild(li);
  });

  // Badge nombre d‚Äôarticles
  cartBadge.textContent = totalItems;

  // Label de l'accord√©on
  const cartAccordionLabel = document.getElementById("cartAccordionLabel");
  if (cartAccordionLabel) {
    cartAccordionLabel.textContent =
      totalItems > 0
        ? `R√©capitulatif du panier (${totalItems} article${totalItems > 1 ? "s" : ""})`
        : "R√©capitulatif du panier";
  }
}


/* ========== Totaux du panier (depuis backend) ========== */
async function updateCartTotals(storeId) {
  try {
    console.log("üîÑ Mise √† jour des totaux du panier‚Ä¶");
               
    // üîπ Appel API checkout
    const res = await fetch(`/api/cart/checkout?store_id=${storeId}`, {
      credentials: "include"
    });
    if (!res.ok) throw new Error(res.statusText);
          
    const data = await res.json();
    console.log("üßæ Totaux re√ßus:", data);
    
    // ‚ö° Harmoniser avec loadStore ‚Üí utiliser store.delivery_fee
// ‚úÖ Utilise les frais calcul√©s par le backend dans storeData
const deliveryFee = window.storeData?.delivery_fee
  ? Number(window.storeData.delivery_fee)
  : Number(data.deliveryFee || 0);
  
    const productsTotal = Number(data.productsTotal || 0);
    const serviceFee    = Number(data.serviceFee || 0);
    const total         = +(productsTotal + serviceFee + deliveryFee).toFixed(2);
        
    // Injection dans le DOM
    const format = v => v.toFixed(2) + " ‚Ç¨";
    document.getElementById("cartSubtotalAmount").textContent = format(productsTotal);
    document.getElementById("serviceAmount").textContent      = format(serviceFee);
    document.getElementById("deliveryAmount").textContent     = format(deliveryFee);
    document.getElementById("cartTotalAmount").textContent    = format(total);
  
    console.log(`‚úÖ Totaux mis √† jour ‚Üí Subtotal: ${productsTotal} | Service: ${serviceFee} | Livraison: ${deliveryFee} | Total: ${total}`);
  } catch (err) {
    console.error("‚ùå Exception updateCartTotals:", err);
  }
}


/* ========== Ajouter un produit au panier (backend) ========== */
async function addToCartBackend(productId, quantity = 1, supplements = {}) {
  console.log("üöÄ addToCartBackend:", { productId, quantity, supplements });

  try {
    const res = await fetch("/api/cart/add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "include", // üîë cookie JWT
       body: JSON.stringify({
        product_id: productId,
        quantity,
        supplements,
        store_id: storeId   // ‚úÖ tr√®s important
      })
      
});   

    // Tenter de lire la r√©ponse JSON (sinon objet vide)
    let data = {};
    try {
      data = await res.json();
    } catch {
      console.warn("‚ö†Ô∏è R√©ponse sans JSON valide");
    }
   
    console.log("üì° R√©ponse backend:", res.status, data);

    if (!res.ok) {
      const msg = data.error || res.statusText || "Erreur inconnue";
      alert("‚ùå Impossible d‚Äôajouter au panier : " + msg);
      return;
    }  
    
// ‚úÖ Recharge le panier du bon store
    await loadCart(storeId);
    await updateCartTotals(storeId);
    animateCart();
        
  } catch (err) {
    console.error("üí• Erreur r√©seau addToCartBackend:", err);
  }
}


/* ========== Vider le panier (backend) ========== */
async function clearCartBackend(storeId) {
  console.log("üóëÔ∏èÔ∏è Ô∏è clearCartBackend appel√©‚Ä¶", storeId);
  try {
    const res = await fetch("/api/cart/clear", {
      method: "POST",
      credentials: "include", // üîë cookie JWT
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ store_id: storeId }) // ‚úÖ envoi dans le body
    });

    if (!res.ok) {
      console.error("‚ùå √âchec clearCart:", res.status, res.statusText);
      return;
    }

    const data = await res.json();
    console.log("‚úÖ R√©ponse clearCart:", data);

    await loadCart(storeId);
    await updateCartTotals(storeId);

  } catch (err) {
    console.error("üí• Exception clearCartBackend:", err);
  }
}


/* ========== Animation badge panier ========== */
function animateCart() {
  const cartBtn = document.querySelector(".cart-btn");
  if (!cartBtn) return;

  cartBtn.classList.add("shake");
  setTimeout(() => cartBtn.classList.remove("shake"), 300);
}

/* ========== Gestion UI du panier ========== */

// Bouton "Vider le panier"
const clearBtn = document.getElementById("clearCartBtn");
if (clearBtn) {
  clearBtn.addEventListener("click", async () => {
    await clearCartBackend();
  });
}

// Accord√©on du panier (ouvrir / fermer les items)
document.addEventListener("click", e => {
  const btn = e.target.closest(".accordion-toggle");
  if (!btn) return;

  const content = btn.nextElementSibling;
  const arrow   = btn.querySelector("#cartAccordionArrow i");

  btn.classList.toggle("active");
  content.style.display = content.style.display === "block" ? "none" : "block";

  if (arrow) {
    arrow.classList.toggle("fa-chevron-down");
    arrow.classList.toggle("fa-chevron-up");
  }
});

/* ========== Chargement au d√©marrage ========== */
document.addEventListener("DOMContentLoaded", () => {
  loadCart();
});

/* ========== Bouton "Ajouter au panier" ========== */
const addBtn = document.getElementById("popup-add-btn");
if (addBtn) {
  addBtn.addEventListener("click", async () => {
    console.log("üëâ Bouton Ajouter au panier cliqu√©");
    
    if (!currentProduct) {
      console.warn("‚ö†Ô∏è Aucun produit s√©lectionn√©");
      return;
    }   

// ‚úÖ utilise la vraie quantit√© choisie
    const qty = window.currentProduct.quantity || 1;

await addToCartBackend(window.currentProduct.id, qty, window.supplementSelections || []);
    
    // ‚úÖ reset avant fermeture
    resetPopupOptions();
    closePopup();
    
    // petite animation sur le bouton panier
    const cartBtn = document.getElementById("btnCart");
    if (cartBtn) {
      cartBtn.classList.add("shake");
      setTimeout(() => cartBtn.classList.remove("shake"), 300);
    }  
  });  
}


/* ========== Gestion du menu contextuel du panier ========== */
const cartMenuBtn     = document.getElementById("cartMenuBtn");
const cartContextMenu = document.getElementById("cartContextMenu");
const clearCartBtn    = document.getElementById("clearCartBtn");

// Ouvrir / fermer le menu au clic sur le bouton
if (cartMenuBtn) {
  cartMenuBtn.addEventListener("click", e => {
    e.stopPropagation();
    cartContextMenu.style.display =
      cartContextMenu.style.display === "block" ? "none" : "block";
  });
}

// Fermer le menu si on clique ailleurs dans la page
document.addEventListener("click", e => {
  if (!cartContextMenu.contains(e.target) && e.target !== cartMenuBtn) {
    cartContextMenu.style.display = "none";
  }
});





// Frais popup
const feesBtn = document.getElementById("feesInfoBtn");
const feesModal = document.getElementById("feesModal");

feesBtn.addEventListener("click", () => {
  // ‚ö° injecter les montants actuels
  const service = document.getElementById("serviceAmount").textContent;
  const delivery = document.getElementById("deliveryAmount").textContent;

  document.getElementById("popupServiceAmount").textContent = service;
  document.getElementById("popupDeliveryAmount").textContent = delivery;

  // calcul du total frais
  const s = parseFloat(service.replace(",", "."));
  const d = parseFloat(delivery.replace(",", "."));
  document.getElementById("popupTotalFees").textContent =
    (s + d).toFixed(2).replace(".", ",") + " ‚Ç¨";

  feesModal.style.display = "flex";
});

// üëá fermer si clic sur overlay
window.addEventListener("click", (e) => {
  if (e.target === feesModal) {
    feesModal.style.display = "none";
  }
});
</script>
<script>


// Pop-up Autres frais
const infoBtn = document.querySelector(".extra-fees .info-icon");
const extraFeesModal = document.getElementById("extraFeesModal");
const closeExtraFees = document.getElementById("closeExtraFees");

infoBtn.addEventListener("click", () => {
  extraFeesModal.style.display = "flex";
});

closeExtraFees.addEventListener("click", () => {
  extraFeesModal.style.display = "none";
});

window.addEventListener("click", (e) => {
  if (e.target === extraFeesModal) {
    extraFeesModal.style.display = "none";
  }
});



</script>
</main>
<footer>
  <div class="container fcols">
    <div>
      <div class="brand" style="gap:10px;margin-bottom:8px">
        <div class="brand-badge">‚ö°Ô∏è</div><b>FlashBring</b>
      </div>
      <div>Livraison locale tout-en-un.</div>
      <div class="copy">¬© <span id="y"></span> FlashBring</div>
    </div>
    <div>
      <b>Entreprise</b>
<a href="index.html#about">√Ä propos</a>
<a href="index.html#careers">Carri√®res</a>
<a href="index.html#press">Presse</a>
    </div>
    <div>
      <b>L√©gal</b>
<a href="index.html#terms">CGU</a>
<a href="index.html#privacy">Confidentialit√©</a>
<a href="index.html#cookies">Cookies</a>
    </div>
    <div>
      <b>Contact</b>
<a href="index.html#support">Support</a>
<a href="index.html#drivers">Devenir livreur</a>
<a href="index.html#partners">Devenir partenaire</a>
</div>

  </div>
</div>


<div class="footer-support">
  <div>Service client 7j/7</div>
  <div>+33 6 33 93 36 90</div>
</div>
</footer>

<script>
  document.getElementById("y").textContent = new Date().getFullYear();
</script>
<script>
  const shareBtn = document.getElementById("shareStoreBtn");
  const shareToast = document.getElementById("shareToast");
  const closeToast = document.getElementById("closeToast");

  if (shareBtn) {
    shareBtn.addEventListener("click", (e) => {
      e.preventDefault();
      navigator.clipboard.writeText(window.location.href).then(() => {
        shareToast.style.display = "block";
        setTimeout(() => {
          shareToast.style.display = "none";
        }, 3000);
      });
    });
  }

  if (closeToast) {
    closeToast.addEventListener("click", () => {
      shareToast.style.display = "none";
    });
  }





</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const heartBtn = document.querySelector(".fa-heart");
  if (heartBtn) {
    heartBtn.addEventListener("click", async () => {
      const storeId = document.getElementById("store-banner").dataset.storeId; // üëà l‚Äôid du store

      try {
        const res = await fetch(`/api/favorites/${storeId}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ user_id: 1 }) // ‚ö°Ô∏è test avec user 1
        });

        if (res.ok) {
          heartBtn.classList.remove("far");
          heartBtn.classList.add("fas");
        } else {
          console.error("Erreur c√¥t√© API", await res.json());
        }
      } catch (err) {
        console.error("Erreur r√©seau", err);
      }
    });
  }
});

</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const checkoutBtn = document.getElementById("checkoutBtn");
  if (!checkoutBtn) return;
      
  checkoutBtn.addEventListener("click", async () => {
    try {
      const storeId = window.storeData?.id;

      // ‚úÖ V√©rifier le panier
      const resCart = await fetch(`/api/cart?store_id=${storeId}`, {
        credentials: "include"
      });
      const cart = await resCart.json();

      if (!cart || cart.length === 0) {
        alert("Votre panier est vide");
        return;
      }

      // ‚úÖ Cr√©er la commande (pas besoin de body, ton backend utilise d√©j√† le panier et la pr√©f√©rence livraison)
      const resOrder = await fetch("/api/orders", {
        method: "POST",
        credentials: "include"
      });

      if (!resOrder.ok) throw new Error("Erreur lors de la cr√©ation de la commande");

      const order = await resOrder.json();
      console.log("‚úÖ Commande cr√©√©e :", order);

      // üëâ Rediriger avec l'ID de la commande
      window.location.href = `cart.html?order_id=${order.id}`;
      
    } catch (err) {
      console.error("‚ö†Ô∏è Exception checkout:", err);
      alert("Impossible de cr√©er la commande");
    }
  });
});
</script>

<!-- ‚úÖ Modal "Hors zone" -->
<div id="deliveryModal" class="modal" style="display:none;">
  <div class="modal-content">
    <h2 id="deliveryModalTitle">‚ùå Hors zone de livraison</h2>
    <p id="deliveryModalText"></p>
    <button id="changeAddressBtn">Changer d‚Äôadresse</button>
  </div>
</div>

<script>
/* ========== Calcul distance (km) ========== */
function getDistanceKm(lat1, lon1, lat2, lon2) {
  const R = 6371; // rayon de la Terre en km
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;

  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(lat1 * Math.PI / 180) *
    Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon / 2) ** 2;

  return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
}

/* ========== V√©rification zone de livraison ========== */
async function checkDeliveryZone(store) {
  try {
    const res = await fetch("/api/users/me", { credentials: "include" });
    if (!res.ok) {
      console.warn("‚ö†Ô∏è Impossible de r√©cup√©rer les infos utilisateur");
      return;
    }

    const user = await res.json();
    if (!user.lat || !user.lng || !store.lat || !store.lng) {
      console.warn("‚ö†Ô∏è Coordonn√©es manquantes pour calculer la distance");
      return;
    }

    const dist = getDistanceKm(user.lat, user.lng, store.lat, store.lng);
    console.log(`üìç Distance client ‚Üí store : ${dist.toFixed(2)} km`);

    if (store.max_km && dist > store.max_km) {
      // --- Afficher le modal ---
      const modal = document.getElementById("deliveryModal");
      const text  = document.getElementById("deliveryModalText");

      if (modal && text) {
        text.textContent = `Vous √™tes trop loin de ${store.name} (${dist.toFixed(1)} km). 
Veuillez changer votre adresse pour commander.`;

        modal.style.display = "flex";         // affichage en mode flex
        document.body.style.overflow = "hidden"; // emp√™che le scroll en arri√®re-plan

        // Bouton pour rediriger vers la page compte/adresse
        const btn = document.getElementById("changeAddressBtn");
        if (btn) {
          btn.onclick = () => {
            window.location.href = "/account.html";
          };
        }
      }
    }
  } catch (err) {
    console.error("‚ùå Erreur checkDeliveryZone:", err);
  }
}


document.addEventListener("DOMContentLoaded", initStore);
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const modifyBtn = document.getElementById("modifyDeliveryBtn");
  const deliveryModal = document.getElementById("deliveryModalCustom");
  const closeDeliveryModal = document.getElementById("closeDeliveryModalCustom");

  const daysContainer = document.getElementById("delivery-days");
  const nextBtn = document.getElementById("nextDaysBtn");
  const prevBtn = document.getElementById("prevDaysBtn");
  const slotsContainer = document.getElementById("delivery-slots");

  // --- Ouvrir / Fermer le modal
  if (modifyBtn && deliveryModal && closeDeliveryModal) {
    modifyBtn.addEventListener("click", () => (deliveryModal.style.display = "flex"));
    closeDeliveryModal.addEventListener("click", () => (deliveryModal.style.display = "none"));
    window.addEventListener("click", (e) => {
      if (e.target === deliveryModal) deliveryModal.style.display = "none";
    });
  }

  // --- G√©n√©ration des jours (Aujourd‚Äôhui + 6) ‚Üí 7 jours total
  const days = [];
  const today = new Date();
  const totalDays = 7;

  for (let i = 0; i < totalDays; i++) {
    const date = new Date();
    date.setDate(today.getDate() + i);

    let label;
    if (i === 0) label = "Aujourd'hui";
    else if (i === 1) label = "Demain";
    else label = date.toLocaleDateString("fr-FR", { weekday: "short" });

    days.push({
      label,
      dateStr: date.toLocaleDateString("fr-FR", { day: "numeric", month: "short" }),
      iso: date.toISOString(),
    });
  }

  let startIndex = 0;
  const visibleCount = 4;

  // --- G√©n√©ration des cr√©neaux horaires
  function generateSlots(selectedDateIso) {
    slotsContainer.innerHTML = ""; // reset

    const selectedDate = new Date(selectedDateIso);
    const today = new Date();
    const isToday = selectedDate.toDateString() === today.toDateString();

    let startHour = 9;
    let endHour = 19;

    if (isToday) {
      // Heure actuelle en France
      const now = new Date().toLocaleString("en-US", { timeZone: "Europe/Paris" });
      const parisNow = new Date(now);
      startHour = parisNow.getHours() + 1; // prochaine heure
      if (startHour < 9) startHour = 9;
      if (startHour >= endHour) {
        slotsContainer.innerHTML = "<p>Aucun cr√©neau disponible aujourd'hui</p>";
        return;
      }
    }


for (let h = startHour; h < endHour; h++) {
  const slotLabel = `${h.toString().padStart(2, "0")}:00 - ${(h + 1)
    .toString()
    .padStart(2, "0")}:00`;
  
  const slotRow = document.createElement("div");
  slotRow.className = "slot-row";
  slotRow.innerHTML = `
    <span>${slotLabel}</span>
    <input type="checkbox" name="slot" value="${slotLabel}">
  `;
  
  slotsContainer.appendChild(slotRow);

  // üëâ r√©cup√®re la checkbox et ajoute le comportement "unique"
  const checkbox = slotRow.querySelector("input");
  checkbox.addEventListener("change", () => {
    if (checkbox.checked) {
      document
        .querySelectorAll("#delivery-slots input[type=checkbox]")
        .forEach(cb => {
          if (cb !== checkbox) cb.checked = false;
        });
    }
  });

 // üëâ ajoute une ligne SEULEMENT si ce n‚Äôest pas le dernier
    if (h < endHour - 1) {
      const hr = document.createElement("hr");
      slotsContainer.appendChild(hr);
    }
  }
} // ‚úÖ bien fermer la fonction


  // --- Affichage des jours
  function renderDays() {
    daysContainer.innerHTML = "";
    const slice = days.slice(startIndex, startIndex + visibleCount);

    slice.forEach((d, idx) => {
      const block = document.createElement("div");
      block.className = "day-block" + (startIndex === 0 && idx === 0 ? " active" : "");
      block.dataset.date = d.iso;

      block.innerHTML = `<strong>${d.label}</strong><span>${d.dateStr}</span>`;

      block.addEventListener("click", () => {
        document.querySelectorAll(".day-block").forEach((b) => b.classList.remove("active"));
        block.classList.add("active");
        generateSlots(block.dataset.date); // üî• Cr√©neaux mis √† jour
      });

      daysContainer.appendChild(block);
    });

    // Fl√®ches visibles ou non
    prevBtn.style.display = startIndex === 0 ? "none" : "flex";
    nextBtn.style.display =
      startIndex + visibleCount >= days.length ? "none" : "flex";

    // Cr√©neaux pour le premier jour visible
    if (slice.length > 0) generateSlots(slice[0].iso);
  }

  // --- Navigation
  if (nextBtn) {
    nextBtn.addEventListener("click", () => {
      if (startIndex + visibleCount < days.length) {
        startIndex = startIndex + visibleCount - 1;
        renderDays();
      }
    });
  }

  if (prevBtn) {
    prevBtn.addEventListener("click", () => {
      if (startIndex > 0) {
        startIndex = Math.max(0, startIndex - (visibleCount - 1));
        renderDays();
      }
    });
  }

  renderDays(); // affichage initial
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const saveBtn = document.querySelector(".btn-save");
  const cancelBtn = document.querySelector(".btn-cancel");

  saveBtn?.addEventListener("click", async () => {
    // üîπ R√©cup√©rer le storeId de l‚ÄôURL
    const params = new URLSearchParams(window.location.search);
    const storeId = parseInt(params.get("id"), 10);

    // üîπ Jour s√©lectionn√©
    const activeDay = document.querySelector(".day-block.active");
    if (!activeDay) {
      alert("Veuillez choisir un jour.");
      return;
    }
    const deliveryDate = activeDay.dataset.date; // tu mets la date en data-date

    // üîπ Cr√©neau s√©lectionn√©
    const slotChecked = document.querySelector("#delivery-slots input[type=checkbox]:checked");
    if (!slotChecked) {
      alert("Veuillez choisir un cr√©neau.");
      return;
    }
    const deliverySlot = slotChecked.value;

    try {
      // Appel backend
      const res = await fetch("/api/deliveries/preferences", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include", // ‚ö°Ô∏è pour envoyer le cookie JWT
        body: JSON.stringify({
          store_id: storeId,
          delivery_date: deliveryDate,
          delivery_slot: deliverySlot
        })
      });

      const data = await res.json();
if (res.ok && data.success) {
  console.log("‚úÖ Horaires enregistr√©s :", data);
  showToastDelivery("Cr√©neau enregistr√© avec succ√®s !"); // üëà utiliser la bonne fonction
  document.getElementById("deliveryModalCustom").style.display = "none"; // ferme le modal
} else {
  alert("Erreur : " + (data.error || "Impossible d‚Äôenregistrer"));
}
    } catch (err) {
      console.error("Erreur:", err);
      alert("Erreur r√©seau");
    }
  });

  cancelBtn?.addEventListener("click", () => {
    document.getElementById("deliveryModalCustom").style.display = "none";
  });
});
</script>
<script>
function showToastDelivery(message, type = "success") {
  const container = document.getElementById("toast-container-delivery");
  if (!container) return;

  const toast = document.createElement("div");
  toast.className = "toast-delivery " + type;
  toast.textContent = message;

  container.appendChild(toast);

  // Animation d'apparition
  setTimeout(() => toast.classList.add("show"), 50);

  // Disparition apr√®s 3s
  setTimeout(() => {
    toast.classList.remove("show");
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}
</script>
<div id="toast-container-delivery"></div>
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const favBtn = document.getElementById("favoriteBtn");
  const favIcon = favBtn?.querySelector("i");
  const params = new URLSearchParams(window.location.search);
  const storeId = params.get("id");
        
  if (!favBtn || !storeId) return;   
      
  try {
    // üëâ V√©rifier si ce store est d√©j√† en favori
    const res = await fetch("/api/favorites", { credentials: "include" });
    if (res.ok) {
      const data = await res.json();
      const isFav = data.favorites.some(f => f.id == storeId);
        
      if (isFav) {
        favIcon.classList.remove("far");
        favIcon.classList.add("fas");
      } 
    }
  } catch (err) {
    console.error("Erreur favoris:", err);
  }
  // üëâ Toggle au clic
  favBtn.addEventListener("click", async () => {
    try {
      const isActive = favIcon.classList.contains("fas");
    

      if (isActive) {
        // Supprimer
        await fetch(`/api/favorites/${storeId}`, {
          method: "DELETE",
          credentials: "include"   
        });
        favIcon.classList.remove("fas");
        favIcon.classList.add("far");
      } else {
        // Ajouter
        await fetch(`/api/favorites/${storeId}`, {
          method: "POST",
          credentials: "include"
        });
        favIcon.classList.remove("far");
        favIcon.classList.add("fas");
      }
    } catch (err) {
      console.error("Erreur toggle favori:", err);
    }
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const searchInput = document.getElementById("store-search-input");
  const productsContainer = document.getElementById("products-container");
  const initialContent = productsContainer.innerHTML;

  // üîπ Ajout d'une box suggestions
  let suggestionsBox = document.createElement("div");
  suggestionsBox.id = "suggestions-box";
  searchInput.parentNode.appendChild(suggestionsBox);

  // Fonction r√©utilisable pour afficher les r√©sultats
  function showResults(query, matches) {
    productsContainer.innerHTML = "";

    const resultsDiv = document.createElement("div");
    resultsDiv.id = "search-results";

    const titleEl = document.createElement("h2");
    titleEl.textContent = `R√©sultats pour "${query}" (${matches.length})`;
    resultsDiv.appendChild(titleEl);

    const grid = document.createElement("div");
    grid.className = "search-results-grid";

    const seen = new Set();
    matches.forEach(p => {
      const title = p.querySelector("h3")?.textContent.trim();
      if (!seen.has(title)) {
        seen.add(title);
        grid.appendChild(p.cloneNode(true));
      }
    });

    resultsDiv.appendChild(grid);
    productsContainer.appendChild(resultsDiv);

    suggestionsBox.style.display = "none";
  }

  // --- √âcoute la saisie
  searchInput.addEventListener("input", () => {
    const query = searchInput.value.toLowerCase().trim();
    suggestionsBox.innerHTML = "";

if (!query) {
  loadProducts(storeId); // üëâ recharge les produits du store
  suggestionsBox.style.display = "none";
  return;
}

    const products = Array.from(productsContainer.querySelectorAll(".product-card"));
    const matches = products.filter(card => {
      const title = card.querySelector("h3")?.textContent.toLowerCase() || "";
      return title.includes(query);
    });

    if (matches.length === 0) {
      suggestionsBox.style.display = "none";
      return;
    }

    // ‚úÖ Suggestions sans doublons
    const seen = new Set();
    matches.forEach(card => {
      const title = card.querySelector("h3")?.textContent || "Sans nom";
      if (seen.has(title)) return;
      seen.add(title);

      const item = document.createElement("div");
      item.textContent = title;
      item.className = "suggestion-item";

      item.addEventListener("click", () => {
        searchInput.value = title; // Mets le choix dans l‚Äôinput
        showResults(title, [card]); // üëâ Affiche UNIQUEMENT ce produit
      });

      suggestionsBox.appendChild(item);
    });

    suggestionsBox.style.display = "block";
  });

  // --- Gestion de la touche Entr√©e (recherche globale)
  searchInput.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      const query = searchInput.value.toLowerCase().trim();
      if (!query) return;

      const products = Array.from(productsContainer.querySelectorAll(".product-card"));
      const matches = products.filter(card => {
        const title = card.querySelector("h3")?.textContent.toLowerCase() || "";
        return title.includes(query);
      });

      if (matches.length > 0) {
        showResults(searchInput.value, matches); // üëâ ici on garde la recherche multiple
      } else {
        suggestionsBox.style.display = "none";
      }
    }
  });

  document.addEventListener("click", e => {
    if (!suggestionsBox.contains(e.target) && e.target !== searchInput) {
      suggestionsBox.style.display = "none";
    }
  });
});
</script>
</body>
</html>
